var CommentWidget=(()=>{var ae=Object.create;var J=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var se=Object.getOwnPropertyNames;var de=Object.getPrototypeOf,ce=Object.prototype.hasOwnProperty;var j=(u=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(u,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):u)(function(u){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+u+'" is not supported')});var G=(u,e)=>()=>(e||u((e={exports:{}}).exports,e),e.exports);var le=(u,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let l of se(e))!ce.call(u,l)&&l!==t&&J(u,l,{get:()=>e[l],enumerable:!(r=ne(e,l))||r.enumerable});return u};var V=(u,e,t)=>(t=u!=null?ae(de(u)):{},le(e||!u||!u.__esModule?J(t,"default",{value:u,enumerable:!0}):t,u));var Z=G(()=>{});var ee=G((W,Q)=>{(function(u,e){typeof W=="object"?Q.exports=W=e():typeof define=="function"&&define.amd?define([],e):u.CryptoJS=e()})(W,function(){var u=u||function(e,t){var r;if(typeof window<"u"&&window.crypto&&(r=window.crypto),typeof self<"u"&&self.crypto&&(r=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(r=globalThis.crypto),!r&&typeof window<"u"&&window.msCrypto&&(r=window.msCrypto),!r&&typeof global<"u"&&global.crypto&&(r=global.crypto),!r&&typeof j=="function")try{r=Z()}catch{}var l=function(){if(r){if(typeof r.getRandomValues=="function")try{return r.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof r.randomBytes=="function")try{return r.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},m=Object.create||function(){function o(){}return function(c){var h;return o.prototype=c,h=new o,o.prototype=null,h}}(),b={},d=b.lib={},k=d.Base=function(){return{extend:function(o){var c=m(this);return o&&c.mixIn(o),(!c.hasOwnProperty("init")||this.init===c.init)&&(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var o=this.extend();return o.init.apply(o,arguments),o},init:function(){},mixIn:function(o){for(var c in o)o.hasOwnProperty(c)&&(this[c]=o[c]);o.hasOwnProperty("toString")&&(this.toString=o.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),v=d.WordArray=k.extend({init:function(o,c){o=this.words=o||[],c!=t?this.sigBytes=c:this.sigBytes=o.length*4},toString:function(o){return(o||T).stringify(this)},concat:function(o){var c=this.words,h=o.words,f=this.sigBytes,w=o.sigBytes;if(this.clamp(),f%4)for(var y=0;y<w;y++){var A=h[y>>>2]>>>24-y%4*8&255;c[f+y>>>2]|=A<<24-(f+y)%4*8}else for(var E=0;E<w;E+=4)c[f+E>>>2]=h[E>>>2];return this.sigBytes+=w,this},clamp:function(){var o=this.words,c=this.sigBytes;o[c>>>2]&=4294967295<<32-c%4*8,o.length=e.ceil(c/4)},clone:function(){var o=k.clone.call(this);return o.words=this.words.slice(0),o},random:function(o){for(var c=[],h=0;h<o;h+=4)c.push(l());return new v.init(c,o)}}),x=b.enc={},T=x.Hex={stringify:function(o){for(var c=o.words,h=o.sigBytes,f=[],w=0;w<h;w++){var y=c[w>>>2]>>>24-w%4*8&255;f.push((y>>>4).toString(16)),f.push((y&15).toString(16))}return f.join("")},parse:function(o){for(var c=o.length,h=[],f=0;f<c;f+=2)h[f>>>3]|=parseInt(o.substr(f,2),16)<<24-f%8*4;return new v.init(h,c/2)}},C=x.Latin1={stringify:function(o){for(var c=o.words,h=o.sigBytes,f=[],w=0;w<h;w++){var y=c[w>>>2]>>>24-w%4*8&255;f.push(String.fromCharCode(y))}return f.join("")},parse:function(o){for(var c=o.length,h=[],f=0;f<c;f++)h[f>>>2]|=(o.charCodeAt(f)&255)<<24-f%4*8;return new v.init(h,c)}},p=x.Utf8={stringify:function(o){try{return decodeURIComponent(escape(C.stringify(o)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(o){return C.parse(unescape(encodeURIComponent(o)))}},g=d.BufferedBlockAlgorithm=k.extend({reset:function(){this._data=new v.init,this._nDataBytes=0},_append:function(o){typeof o=="string"&&(o=p.parse(o)),this._data.concat(o),this._nDataBytes+=o.sigBytes},_process:function(o){var c,h=this._data,f=h.words,w=h.sigBytes,y=this.blockSize,A=y*4,E=w/A;o?E=e.ceil(E):E=e.max((E|0)-this._minBufferSize,0);var F=E*y,D=e.min(F*4,w);if(F){for(var $=0;$<F;$+=y)this._doProcessBlock(f,$);c=f.splice(0,F),h.sigBytes-=D}return new v.init(c,D)},clone:function(){var o=k.clone.call(this);return o._data=this._data.clone(),o},_minBufferSize:0}),_=d.Hasher=g.extend({cfg:k.extend(),init:function(o){this.cfg=this.cfg.extend(o),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(o){return this._append(o),this._process(),this},finalize:function(o){o&&this._append(o);var c=this._doFinalize();return c},blockSize:512/32,_createHelper:function(o){return function(c,h){return new o.init(h).finalize(c)}},_createHmacHelper:function(o){return function(c,h){return new S.HMAC.init(o,h).finalize(c)}}}),S=b.algo={};return b}(Math);return u})});var re=G((q,te)=>{(function(u,e){typeof q=="object"?te.exports=q=e(ee()):typeof define=="function"&&define.amd?define(["./core"],e):e(u.CryptoJS)})(q,function(u){return function(e){var t=u,r=t.lib,l=r.WordArray,m=r.Hasher,b=t.algo,d=[];(function(){for(var p=0;p<64;p++)d[p]=e.abs(e.sin(p+1))*4294967296|0})();var k=b.MD5=m.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(p,g){for(var _=0;_<16;_++){var S=g+_,o=p[S];p[S]=(o<<8|o>>>24)&16711935|(o<<24|o>>>8)&4278255360}var c=this._hash.words,h=p[g+0],f=p[g+1],w=p[g+2],y=p[g+3],A=p[g+4],E=p[g+5],F=p[g+6],D=p[g+7],$=p[g+8],R=p[g+9],B=p[g+10],L=p[g+11],N=p[g+12],I=p[g+13],z=p[g+14],P=p[g+15],i=c[0],a=c[1],n=c[2],s=c[3];i=v(i,a,n,s,h,7,d[0]),s=v(s,i,a,n,f,12,d[1]),n=v(n,s,i,a,w,17,d[2]),a=v(a,n,s,i,y,22,d[3]),i=v(i,a,n,s,A,7,d[4]),s=v(s,i,a,n,E,12,d[5]),n=v(n,s,i,a,F,17,d[6]),a=v(a,n,s,i,D,22,d[7]),i=v(i,a,n,s,$,7,d[8]),s=v(s,i,a,n,R,12,d[9]),n=v(n,s,i,a,B,17,d[10]),a=v(a,n,s,i,L,22,d[11]),i=v(i,a,n,s,N,7,d[12]),s=v(s,i,a,n,I,12,d[13]),n=v(n,s,i,a,z,17,d[14]),a=v(a,n,s,i,P,22,d[15]),i=x(i,a,n,s,f,5,d[16]),s=x(s,i,a,n,F,9,d[17]),n=x(n,s,i,a,L,14,d[18]),a=x(a,n,s,i,h,20,d[19]),i=x(i,a,n,s,E,5,d[20]),s=x(s,i,a,n,B,9,d[21]),n=x(n,s,i,a,P,14,d[22]),a=x(a,n,s,i,A,20,d[23]),i=x(i,a,n,s,R,5,d[24]),s=x(s,i,a,n,z,9,d[25]),n=x(n,s,i,a,y,14,d[26]),a=x(a,n,s,i,$,20,d[27]),i=x(i,a,n,s,I,5,d[28]),s=x(s,i,a,n,w,9,d[29]),n=x(n,s,i,a,D,14,d[30]),a=x(a,n,s,i,N,20,d[31]),i=T(i,a,n,s,E,4,d[32]),s=T(s,i,a,n,$,11,d[33]),n=T(n,s,i,a,L,16,d[34]),a=T(a,n,s,i,z,23,d[35]),i=T(i,a,n,s,f,4,d[36]),s=T(s,i,a,n,A,11,d[37]),n=T(n,s,i,a,D,16,d[38]),a=T(a,n,s,i,B,23,d[39]),i=T(i,a,n,s,I,4,d[40]),s=T(s,i,a,n,h,11,d[41]),n=T(n,s,i,a,y,16,d[42]),a=T(a,n,s,i,F,23,d[43]),i=T(i,a,n,s,R,4,d[44]),s=T(s,i,a,n,N,11,d[45]),n=T(n,s,i,a,P,16,d[46]),a=T(a,n,s,i,w,23,d[47]),i=C(i,a,n,s,h,6,d[48]),s=C(s,i,a,n,D,10,d[49]),n=C(n,s,i,a,z,15,d[50]),a=C(a,n,s,i,E,21,d[51]),i=C(i,a,n,s,N,6,d[52]),s=C(s,i,a,n,y,10,d[53]),n=C(n,s,i,a,B,15,d[54]),a=C(a,n,s,i,f,21,d[55]),i=C(i,a,n,s,$,6,d[56]),s=C(s,i,a,n,P,10,d[57]),n=C(n,s,i,a,F,15,d[58]),a=C(a,n,s,i,I,21,d[59]),i=C(i,a,n,s,A,6,d[60]),s=C(s,i,a,n,L,10,d[61]),n=C(n,s,i,a,w,15,d[62]),a=C(a,n,s,i,R,21,d[63]),c[0]=c[0]+i|0,c[1]=c[1]+a|0,c[2]=c[2]+n|0,c[3]=c[3]+s|0},_doFinalize:function(){var p=this._data,g=p.words,_=this._nDataBytes*8,S=p.sigBytes*8;g[S>>>5]|=128<<24-S%32;var o=e.floor(_/4294967296),c=_;g[(S+64>>>9<<4)+15]=(o<<8|o>>>24)&16711935|(o<<24|o>>>8)&4278255360,g[(S+64>>>9<<4)+14]=(c<<8|c>>>24)&16711935|(c<<24|c>>>8)&4278255360,p.sigBytes=(g.length+1)*4,this._process();for(var h=this._hash,f=h.words,w=0;w<4;w++){var y=f[w];f[w]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360}return h},clone:function(){var p=m.clone.call(this);return p._hash=this._hash.clone(),p}});function v(p,g,_,S,o,c,h){var f=p+(g&_|~g&S)+o+h;return(f<<c|f>>>32-c)+g}function x(p,g,_,S,o,c,h){var f=p+(g&S|_&~S)+o+h;return(f<<c|f>>>32-c)+g}function T(p,g,_,S,o,c,h){var f=p+(g^_^S)+o+h;return(f<<c|f>>>32-c)+g}function C(p,g,_,S,o,c,h){var f=p+(_^(g|~S))+o+h;return(f<<c|f>>>32-c)+g}t.MD5=m._createHelper(k),t.HmacMD5=m._createHmacHelper(k)}(Math),u.MD5})});var M=class{constructor(e="http://localhost:8000"){this.baseUrl=e,this.defaultHeaders={"Content-Type":"application/json"}}async request(e,t={}){let r=`${this.baseUrl}${e}`,l={headers:{...this.defaultHeaders,...t.headers},...t};try{let m=await fetch(r,l);if(!m.ok){let b=await m.json().catch(()=>({}));throw new Error(b.detail||`HTTP ${m.status}: ${m.statusText}`)}return await m.json()}catch(m){throw m.name==="TypeError"&&m.message.includes("fetch")?new Error("Network error: Unable to connect to API"):m}}async getComments(e,t={}){let r=new URLSearchParams({thread_id:e,...t});return this.request(`/widget/comments/${e}?${r}`)}async createComment(e){return this.request("/comments",{method:"POST",body:JSON.stringify(e)})}async updateComment(e,t){return this.request(`/comments/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteComment(e){return this.request(`/comments/${e}`,{method:"DELETE"})}async moderateComment(e,t){return this.request(`/comments/${e}/moderate`,{method:"PUT",body:JSON.stringify(t)})}async getThread(e){return this.request(`/threads/${e}`)}async createThread(e){return this.request("/threads",{method:"POST",body:JSON.stringify(e)})}async getDemoThread(){return this.request("/demo/thread")}async healthCheck(){return this.request("/health")}};var K=V(j("dompurify"),1),me={ALLOWED_TAGS:["p","br","strong","em","a","code"],ALLOWED_ATTR:{a:["href","rel"]},ALLOW_UNKNOWN_PROTOCOLS:!1,ALLOWED_URI_REGEXP:/^https?:\/\//i,FORBID_ATTR:["target","style","onerror","onclick","onload","id","class","name"],FORBID_TAGS:["script","iframe","object","embed","style","img"],RETURN_TRUSTED_TYPE:!0,KEEP_CONTENT:!1,SANITIZE_DOM:!0,WHOLE_DOCUMENT:!1,FORCE_BODY:!0,HOOKS:{afterSanitizeAttributes:function(u){if(u.tagName==="A"){u.setAttribute("rel","noopener noreferrer nofollow ugc"),u.removeAttribute("target");let e=u.getAttribute("href");e&&!/^https?:\/\//i.test(e)&&u.removeAttribute("href")}}}},fe={ALLOWED_TAGS:[],ALLOWED_ATTR:{},KEEP_CONTENT:!0,RETURN_TRUSTED_TYPE:!1};function X(u,e={}){if(!u)return"";let{allowHTML:t=!1,allowLinks:r=!1,convertNewlines:l=!0,maxLength:m=5e3}=e;u.length>m&&(u=u.substring(0,m));let b;if(!t)b=K.default.sanitize(u,fe),l&&(b=b.replace(/\n/g,"<br>"));else{let k={...me};r||(k.ALLOWED_TAGS=k.ALLOWED_TAGS.filter(v=>v!=="a"),k.ALLOWED_ATTR={}),b=K.default.sanitize(u,k)}let d=[/javascript:/gi,/data:text\/html/gi,/vbscript:/gi,/on\w+\s*=/gi,/<script/gi,/<iframe/gi];for(let k of d)if(k.test(b))return console.error("[Security] Blocked malicious comment content"),"[Comment removed for security]";return b}var O=class{constructor(){this.templates={widget:e=>`
                <div class="comment-widget" data-theme="${e.theme}" role="region" aria-label="Comment widget">
                    <div class="comment-header">
                        <h3>\u{1F4AC} Comments</h3>
                        ${e.showThemeSelector?this.renderThemeSelector(e.theme,e.onThemeChange):""}
                    </div>

                    ${e.error?this.renderError(e.error):""}

                    ${e.loading?this.renderLoading():""}

                    ${!e.loading&&!e.error?this.renderCommentForm(e.onSubmit,e.replyingTo,e.onCancelReply):""}

                    <div class="comment-list" role="region" aria-label="Comments list">
                        ${e.comments.length>0?e.comments.map(t=>this.renderComment(t,0,e.maxDepth,e.onReply)).join(""):this.renderEmptyState()}
                    </div>
                </div>
            `,comment:(e,t,r,l)=>`
                <article class="comment-item level-${t}" data-id="${e.id}" style="margin-left: ${t*20}px;" role="article" aria-labelledby="comment-author-${e.id}" aria-describedby="comment-content-${e.id}">
                    <div class="comment-avatar">
                        <div class="avatar-placeholder" aria-hidden="true">
                            ${e.author_name.charAt(0).toUpperCase()}
                        </div>
                    </div>
                    <div class="comment-content">
                        <div class="comment-meta">
                            <span class="comment-author" id="comment-author-${e.id}">${this.escapeHtml(e.author_name)}</span>
                            <time class="comment-date" datetime="${e.created_at}" aria-label="Posted ${this.formatDate(e.created_at)}">${this.formatDate(e.created_at)}</time>
                        </div>
                        <div class="comment-text" id="comment-content-${e.id}">${this.formatContent(e.content)}</div>
                        <div class="comment-actions">
                            ${t<r?`<button class="reply-btn" data-parent-id="${e.id}" aria-label="Reply to ${this.escapeHtml(e.author_name)}'s comment">Reply</button>`:""}
                        </div>
                        ${e.replies&&e.replies.length>0?`<div class="comment-replies" role="region" aria-label="Replies to this comment">${e.replies.map(m=>this.renderComment(m,t+1,r,l)).join("")}</div>`:""}
                    </div>
                </article>
            `,form:(e,t,r)=>`
                <form class="comment-form" id="comment-form" role="form" aria-label="${t?"Reply to comment":"Add new comment"}">
                    ${t?`<div class="reply-indicator" role="status" aria-live="polite">Replying to comment #${t}</div>`:""}
                    <div class="form-group">
                        <input type="text" id="author-name" name="author-name" placeholder="Your name" required aria-label="Your name" aria-required="true">
                    </div>
                    <div class="form-group">
                        <input type="email" id="author-email" name="author-email" placeholder="Your email" required aria-label="Your email address" aria-required="true" aria-describedby="email-help">
                        <div id="email-help" class="sr-only">Your email will not be published</div>
                    </div>
                    <div class="form-group">
                        <textarea id="comment-content" name="comment-content" placeholder="${t?"Write your reply...":"Write your comment..."}" required rows="4" aria-label="${t?"Write your reply":"Write your comment"}" aria-required="true"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="submit-btn" aria-describedby="submit-help">${t?"Post Reply":"Post Comment"}</button>
                        ${t?'<button type="button" class="cancel-reply-btn" id="cancel-reply-btn" aria-label="Cancel reply">Cancel Reply</button>':""}
                        <div id="submit-help" class="sr-only">Submit your ${t?"reply":"comment"}</div>
                    </div>
                </form>
            `,themeSelector:(e,t)=>`
                <label for="theme-selector" class="sr-only">Choose theme</label>
                <select class="theme-selector" id="theme-selector" aria-label="Select comment widget theme">
                    <option value="default" ${e==="default"?"selected":""}>Default</option>
                    <option value="dark" ${e==="dark"?"selected":""}>Dark</option>
                    <option value="matrix" ${e==="matrix"?"selected":""}>Matrix</option>
                    <option value="neocities" ${e==="neocities"?"selected":""}>NeoCities</option>
                    <option value="serene-mist" ${e==="serene-mist"?"selected":""}>Serene Mist</option>
                    <option value="neon-pulse" ${e==="neon-pulse"?"selected":""}>Neon Pulse</option>
                    <option value="geometric-prime" ${e==="geometric-prime"?"selected":""}>Geometric Prime</option>
                    <option value="forest-flow" ${e==="forest-flow"?"selected":""}>Forest Flow</option>
                    <option value="digital-chaos" ${e==="digital-chaos"?"selected":""}>Digital Chaos</option>
                </select>
            `,loading:()=>`
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Loading comments...</p>
                </div>
            `,error:e=>`
                <div class="error-state">
                    <p>\u274C ${this.escapeHtml(e)}</p>
                </div>
            `,empty:()=>`
                <div class="empty-state">
                    <p>\u{1F4AD} No comments yet. Be the first to comment!</p>
                </div>
            `}}render(e){return this.templates.widget(e)}renderComment(e,t,r){return this.templates.comment(e,t,r)}renderCommentForm(e,t,r){return this.templates.form(e,t,r)}enhanceFormAccessibility(e){if(!e)return;let t=e.querySelector('input[name="author-name"]');t&&(t.setAttribute("aria-label","Your name"),t.setAttribute("aria-required","true"));let r=e.querySelector('input[name="author-email"]');r&&(r.setAttribute("aria-label","Your email address"),r.setAttribute("aria-required","true"),r.setAttribute("aria-describedby","email-help"));let l=e.querySelector('textarea[name="comment-content"]');l&&(l.setAttribute("aria-label",replyingTo?"Write your reply":"Write your comment"),l.setAttribute("aria-required","true"));let m=document.createElement("div");m.id="email-help",m.className="sr-only",m.textContent="Your email will not be published",e.appendChild(m)}renderThemeSelector(e,t){return this.templates.themeSelector(e,t)}renderLoading(){return this.templates.loading()}renderError(e){return this.templates.error(e)}renderEmptyState(){return this.templates.empty()}formatDate(e){if(!e)return"";let t=new Date(e),l=Math.floor((new Date-t)/(1e3*60*60));return l<1?"Just now":l<24?`${l}h ago`:t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}formatContent(e){return X(e,{allowHTML:!1,convertNewlines:!0})}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}};var H=class{constructor(e="default"){this.currentTheme=e,this.themes={default:this.getDefaultTheme(),dark:this.getDarkTheme(),matrix:this.getMatrixTheme(),neocities:this.getNeocitiesTheme(),"serene-mist":this.getSereneMistTheme(),"neon-pulse":this.getNeonPulseTheme(),"geometric-prime":this.getGeometricPrimeTheme(),"forest-flow":this.getForestFlowTheme(),"digital-chaos":this.getDigitalChaosTheme()},this.themeCSS=new Map,this.transitionDuration=300,this.init()}init(){document.addEventListener("themeChange",e=>{this.syncWithDashboard(e.detail.theme)}),this.loadThemeCSS()}setTheme(e,t=!0){this.themes[e]||(console.warn(`Theme "${e}" not found, falling back to default`),e="default");let r=this.currentTheme;this.currentTheme=e,this.applyTheme(t),this.dispatchThemeChange(r,e)}syncWithDashboard(e){let r={default:"default",dark:"dark",matrix:"matrix",neocities:"neocities"}[e]||"default";r!==this.currentTheme&&this.setTheme(r,!0)}applyTheme(e=!0){let t=this.themes[this.currentTheme]||this.themes.default;this.applyCSSVariables(t,e),this.applyThemeEffects(t),this.updateMetaThemeColor(t.colors.primary)}applyCSSVariables(e,t=!0){let r=document.documentElement;t?(r.style.setProperty("--widget-transition-duration",e.transitions.duration),r.style.setProperty("--widget-transition-easing",e.transitions.easing)):r.style.setProperty("--widget-transition-duration","0s"),Object.entries(e.colors).forEach(([l,m])=>{r.style.setProperty(`--widget-${l}`,m)}),Object.entries(e.fonts).forEach(([l,m])=>{r.style.setProperty(`--widget-font-${l}`,m)}),Object.entries(e.spacing).forEach(([l,m])=>{r.style.setProperty(`--widget-spacing-${l}`,m)}),r.style.setProperty("--widget-border-radius",e.borderRadius)}applyThemeEffects(e){let t=document.querySelector("comment-widget");if(t&&t.shadowRoot){let r=t.shadowRoot.querySelector("#indie-comments-app");r&&(r.className=r.className.replace(/theme-\w+/g,""),r.classList.add(`theme-${this.currentTheme}`))}switch(this.currentTheme){case"matrix":this.applyMatrixEffects();break;case"neocities":this.applyNeocitiesEffects();break;case"dark":this.applyDarkEffects();break;case"serene-mist":this.applySereneMistEffects();break;case"neon-pulse":this.applyNeonPulseEffects();break;case"geometric-prime":this.applyGeometricPrimeEffects();break;case"forest-flow":this.applyForestFlowEffects();break;case"digital-chaos":this.applyDigitalChaosEffects();break;default:this.applyDefaultEffects()}}applyMatrixEffects(){console.log("Matrix theme effects applied")}applyNeocitiesEffects(){console.log("NeoCities theme effects applied")}applyDarkEffects(){console.log("Dark theme effects applied")}applyDefaultEffects(){console.log("Default theme effects applied")}applySereneMistEffects(){this.widgetElement.style.animation="serene-breath 4s ease-in-out infinite"}applyNeonPulseEffects(){this.widgetElement.style.animation="neon-pulse 2s ease-in-out infinite"}applyGeometricPrimeEffects(){this.widgetElement.style.animation="geometric-rotate 8s linear infinite"}applyForestFlowEffects(){this.widgetElement.style.animation="forest-wave 6s ease-in-out infinite"}applyDigitalChaosEffects(){this.widgetElement.style.animation="digital-glitch 0.3s ease-in-out infinite, scan-line 2s linear infinite"}updateMetaThemeColor(e){let t=document.querySelector('meta[name="theme-color"]');t||(t=document.createElement("meta"),t.name="theme-color",document.head.appendChild(t)),t.content=e}dispatchThemeChange(e,t){document.dispatchEvent(new CustomEvent("commentWidgetThemeChange",{detail:{theme:t,previousTheme:e,config:this.themes[t]}}))}async loadThemeCSS(){let e={dark:"/frontend/static/css/themes/dark.css",matrix:"/frontend/static/css/themes/matrix.css",neocities:"/frontend/static/css/themes/neocities.css"};for(let[t,r]of Object.entries(e))try{let l=await fetch(r);if(l.ok){let m=await l.text();this.themeCSS.set(t,m)}}catch(l){console.warn(`Failed to load theme CSS for ${t}:`,l)}}getThemeCSS(e){return this.themeCSS.get(e)||""}getDefaultTheme(){return`
            /* Default theme with CSS variables */
            .comment-widget {
                font-family: var(--widget-font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
                max-width: 680px;
                margin: 2rem auto;
                padding: 1.5rem;
                background: var(--widget-background, #fff);
                border: 1px solid var(--widget-border, #e0e0e0);
                border-radius: var(--widget-border-radius, 8px);
                box-shadow: 0 2px 10px var(--widget-shadow, rgba(0,0,0,0.1));
                color: var(--widget-text, #333);
                transition: var(--widget-transition, all 0.3s ease);
            }

            .comment-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1.5rem;
                padding-bottom: 1rem;
                border-bottom: 1px solid var(--widget-border, #e0e0e0);
            }

            .comment-header h3 {
                margin: 0;
                color: var(--widget-text, #333);
                font-size: 1.5rem;
                font-weight: 600;
            }

            .theme-selector {
                padding: 0.5rem;
                border: 1px solid var(--widget-border, #ddd);
                border-radius: var(--widget-border-radius, 4px);
                background: var(--widget-surface, #fff);
                color: var(--widget-text, #333);
                font-size: 0.9rem;
            }

            .comment-form {
                background: var(--widget-surface, #f8f9fa);
                padding: 1.5rem;
                border-radius: var(--widget-border-radius, 6px);
                margin-bottom: 2rem;
                border: 1px solid var(--widget-border, #e9ecef);
            }

            .form-group {
                margin-bottom: 1rem;
            }

            .form-group input,
            .form-group textarea {
                width: 100%;
                padding: 0.75rem;
                border: 1px solid var(--widget-border, #ddd);
                border-radius: var(--widget-border-radius, 4px);
                font-size: 1rem;
                box-sizing: border-box;
                font-family: inherit;
                background: var(--widget-surface, #fff);
                color: var(--widget-text, #333);
                transition: var(--widget-transition, border-color 0.2s);
            }

            .form-group input:focus,
            .form-group textarea:focus {
                border-color: var(--widget-primary, #007cba);
                box-shadow: 0 0 0 0.2rem rgba(0, 124, 186, 0.25);
            }

            .form-group textarea {
                min-height: 100px;
                resize: vertical;
            }

            .form-actions {
                text-align: right;
            }

            .submit-btn {
                background: var(--widget-primary, #007cba);
                color: white;
                border: none;
                padding: 0.75rem 1.5rem;
                border-radius: var(--widget-border-radius, 4px);
                font-size: 1rem;
                cursor: pointer;
                transition: var(--widget-transition, background 0.2s);
            }

            .submit-btn:hover {
                background: var(--widget-primary, #007cba);
                opacity: 0.9;
                transform: translateY(-1px);
            }

            .comment-list {
                margin-top: 1.5rem;
            }

            .comment-item {
                display: flex;
                padding: 1rem;
                margin-bottom: 1rem;
                background: var(--widget-surface, #fff);
                border: 1px solid var(--widget-border, #eee);
                border-radius: var(--widget-border-radius, 6px);
                border-left: 3px solid var(--widget-primary, #007cba);
                transition: var(--widget-transition, all 0.2s);
            }

            .comment-item:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 12px var(--widget-shadow, rgba(0,0,0,0.1));
            }

            .comment-item.level-1 {
                margin-left: 2rem;
                border-left-width: 2px;
                border-left-color: var(--widget-secondary, #888);
            }

            .comment-item.level-2 {
                margin-left: 3rem;
                border-left-width: 1px;
                border-left-color: var(--widget-border, #ccc);
            }

            .comment-avatar {
                margin-right: 1rem;
                flex-shrink: 0;
            }

            .avatar-placeholder {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: var(--widget-primary, #007cba);
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 1.1rem;
            }

            .comment-content {
                flex: 1;
            }

            .comment-meta {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 0.5rem;
                font-size: 0.9rem;
            }

            .comment-author {
                font-weight: 600;
                color: var(--widget-primary, #007cba);
            }

            .comment-date {
                color: var(--widget-text-muted, #888);
            }

            .comment-text {
                line-height: 1.6;
                color: var(--widget-text, #444);
                margin-bottom: 0.5rem;
            }

            .comment-actions {
                font-size: 0.8rem;
            }

            .reply-btn {
                background: none;
                border: none;
                color: var(--widget-primary, #007cba);
                cursor: pointer;
                text-decoration: underline;
                font-size: 0.8rem;
                transition: var(--widget-transition, color 0.2s);
            }

            .reply-btn:hover {
                color: var(--widget-primary, #007cba);
                opacity: 0.8;
            }

            .comment-replies {
                margin-top: 1rem;
                margin-left: 1rem;
            }

            .loading-state,
            .error-state,
            .empty-state {
                text-align: center;
                padding: 2rem;
                font-style: italic;
            }

            .loading-state {
                color: var(--widget-text-muted, #666);
            }

            .error-state {
                color: var(--widget-danger, #dc3545);
                background: rgba(220, 53, 69, 0.1);
                border: 1px solid var(--widget-danger, #dc3545);
                border-radius: var(--widget-border-radius, 4px);
            }

            .empty-state {
                color: var(--widget-text-muted, #666);
            }

            .spinner {
                border: 3px solid var(--widget-light, #f3f3f3);
                border-top: 3px solid var(--widget-primary, #007cba);
                border-radius: 50%;
                width: 30px;
                height: 30px;
                animation: spin 1s linear infinite;
                margin: 0 auto 1rem;
            }

            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

            @media (max-width: 768px) {
                .comment-widget {
                    margin: 1rem;
                    padding: 1rem;
                }

                .comment-item.level-1,
                .comment-item.level-2 {
                    margin-left: 1rem;
                }

                .theme-selector {
                    margin-top: 0.5rem;
                    width: 100%;
                }

                .comment-header {
                    flex-direction: column;
                    align-items: stretch;
                }
            }
        `}getDarkTheme(){return`
            .comment-widget {
                background: #2d2d2d;
                border-color: #444;
                color: #e0e0e0;
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            }

            .comment-header h3 {
                color: #e0e0e0;
            }

            .theme-selector {
                background: #3a3a3a;
                border-color: #555;
                color: #e0e0e0;
            }

            .comment-form {
                background: #3a3a3a;
                border-color: #555;
            }

            .form-group input,
            .form-group textarea {
                background: #3a3a3a;
                border-color: #555;
                color: #e0e0e0;
            }

            .submit-btn {
                background: #4fc3f7;
                color: #000;
            }

            .submit-btn:hover {
                background: #29b6f6;
            }

            .comment-item {
                background: #2d2d2d;
                border-color: #444;
                color: #e0e0e0;
                border-left-color: #4fc3f7;
            }

            .comment-item.level-1 {
                border-left-color: #888;
            }

            .comment-item.level-2 {
                border-left-color: #ccc;
            }

            .avatar-placeholder {
                background: #4fc3f7;
                color: #000;
            }

            .comment-author {
                color: #4fc3f7;
            }

            .comment-date {
                color: #b0b0b0;
            }

            .comment-text {
                color: #e0e0e0;
            }

            .reply-btn {
                color: #4fc3f7;
            }

            .reply-btn:hover {
                color: #29b6f6;
            }

            .loading-state,
            .empty-state {
                color: #b0b0b0;
            }

            .error-state {
                color: #ff6b6b;
                background: rgba(255, 107, 107, 0.1);
                border-color: rgba(255, 107, 107, 0.3);
            }
        `}getMatrixTheme(){return`
            .comment-widget {
                background: #000;
                border-color: #0a0;
                color: #0f0;
                font-family: 'Courier New', monospace;
                box-shadow: 0 2px 10px rgba(0,255,0,0.1);
            }

            .comment-header h3 {
                color: #0f0;
            }

            .theme-selector {
                background: #010;
                border-color: #080;
                color: #0f0;
                font-family: 'Courier New', monospace;
            }

            .comment-form {
                background: #010;
                border-color: #080;
            }

            .form-group input,
            .form-group textarea {
                background: #010;
                border-color: #080;
                color: #0f0;
                font-family: 'Courier New', monospace;
            }

            .submit-btn {
                background: #0a0;
                color: #000;
                font-family: 'Courier New', monospace;
            }

            .submit-btn:hover {
                background: #0f0;
                box-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
            }

            .comment-item {
                background: #000;
                border-color: #0a0;
                color: #0f0;
                border-left-color: #0f0;
                font-family: 'Courier New', monospace;
            }

            .comment-item.level-1 {
                border-left-color: #080;
            }

            .comment-item.level-2 {
                border-left-color: #040;
            }

            .avatar-placeholder {
                background: #0f0;
                color: #000;
            }

            .comment-author {
                color: #0f0;
            }

            .comment-date {
                color: #6b7280;
            }

            .comment-text {
                color: #0f0;
            }

            .reply-btn {
                color: #0f0;
            }

            .reply-btn:hover {
                color: #0a0;
                text-shadow: 0 0 3px rgba(0, 255, 0, 0.5);
            }

            .loading-state,
            .empty-state {
                color: #6b7280;
            }

            .error-state {
                color: #ff4444;
                background: rgba(255, 68, 68, 0.1);
                border-color: rgba(255, 68, 68, 0.3);
            }
        `}getNeocitiesTheme(){return`
            .comment-widget {
                background: #ccffff;
                border: 2px dashed #996699;
                color: #330033;
                box-shadow: 0 4px 15px rgba(153, 102, 153, 0.2);
            }

            .comment-header h3 {
                color: #330033;
            }

            .theme-selector {
                background: #ffff99;
                border: 2px dotted #669966;
                color: #330033;
            }

            .comment-form {
                background: #ffff99;
                border: 2px dotted #669966;
            }

            .form-group input,
            .form-group textarea {
                background: #ffff99;
                border: 2px dotted #669966;
                color: #330033;
            }

            .submit-btn {
                background: #ffccff;
                color: #330033;
                border: 2px solid #996699;
            }

            .submit-btn:hover {
                background: #ff99ff;
            }

            .comment-item {
                background: #ccffff;
                border: 2px dashed #996699;
                color: #330033;
                border-left: 4px solid #996699;
            }

            .comment-item.level-1 {
                border-left-color: #669966;
                border-left-style: dotted;
            }

            .comment-item.level-2 {
                border-left-color: #cc99ff;
                border-left-style: dashed;
            }

            .avatar-placeholder {
                background: #ffccff;
                color: #330033;
                border: 2px solid #996699;
            }

            .comment-author {
                color: #663399;
                font-weight: bold;
            }

            .comment-date {
                color: #666699;
            }

            .comment-text {
                color: #330033;
            }

            .reply-btn {
                color: #663399;
                background: #ffccff;
                border: 1px solid #996699;
                padding: 0.2rem 0.5rem;
                border-radius: 3px;
            }

            .reply-btn:hover {
                background: #ff99ff;
            }

            .loading-state,
            .empty-state {
                color: #666699;
            }

            .error-state {
                color: #cc0000;
                background: rgba(255, 204, 204, 0.7);
                border: 2px dashed #cc6666;
            }
        `}getSereneMistTheme(){return{colors:{primary:"#8B9D77",secondary:"#A8B5A0",background:"#F8F9F7",surface:"#FFFFFF",text:"#4A5D3A","text-muted":"#7A8F69",border:"#D4E2D0",light:"#F0F2EF",danger:"#C17D5F"},fonts:{family:"'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif",size:"14px",weight:"400"},spacing:{small:"8px",medium:"16px",large:"24px"},borderRadius:"12px",transitions:{duration:"0.4s",easing:"cubic-bezier(0.4, 0, 0.2, 1)"}}}getNeonPulseTheme(){return{colors:{primary:"#00FF88",secondary:"#FF0080",background:"#0A0A0A",surface:"#1A1A1A",text:"#FFFFFF","text-muted":"#888888",border:"#333333",light:"#2A2A2A",danger:"#FF4444"},fonts:{family:"'JetBrains Mono', 'Courier New', monospace",size:"14px",weight:"400"},spacing:{small:"8px",medium:"16px",large:"24px"},borderRadius:"4px",transitions:{duration:"0.2s",easing:"ease-out"}}}getGeometricPrimeTheme(){return{colors:{primary:"#FF6B35",secondary:"#F7931E",background:"#2C2C2C",surface:"#3A3A3A",text:"#FFFFFF","text-muted":"#CCCCCC",border:"#555555",light:"#4A4A4A",danger:"#FF4444"},fonts:{family:"'IBM Plex Sans', sans-serif",size:"14px",weight:"500"},spacing:{small:"12px",medium:"20px",large:"32px"},borderRadius:"0px",transitions:{duration:"0.3s",easing:"ease-in-out"}}}getForestFlowTheme(){return{colors:{primary:"#2D5A3D",secondary:"#4A7C59",background:"#F5F8F5",surface:"#FFFFFF",text:"#1A3D2A","text-muted":"#5A8F6B",border:"#B8D4BB",light:"#E8F5E8",danger:"#8B4513"},fonts:{family:"'Crimson Text', serif",size:"15px",weight:"400"},spacing:{small:"10px",medium:"18px",large:"28px"},borderRadius:"16px",transitions:{duration:"0.5s",easing:"ease-in-out"}}}getDigitalChaosTheme(){return{colors:{primary:"#FF00FF",secondary:"#00FFFF",background:"#000000",surface:"#0F0F0F",text:"#FFFFFF","text-muted":"#AAAAAA",border:"#333333",light:"#1A1A1A",danger:"#FF0000"},fonts:{family:"'Share Tech Mono', monospace",size:"13px",weight:"400"},spacing:{small:"6px",medium:"12px",large:"18px"},borderRadius:"2px",transitions:{duration:"0.1s",easing:"step-end"}}}};var oe=V(re(),1),Y=class{static isLocalhost(){return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"}static generateThreadId(){return this.isLocalhost()?"demo_site":(0,oe.default)(window.location.href).toString().substring(0,16)}static generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static debounce(e,t){let r;return function(...m){let b=()=>{clearTimeout(r),e(...m)};clearTimeout(r),r=setTimeout(b,t)}}static throttle(e,t){let r;return function(){let l=arguments,m=this;r||(e.apply(m,l),r=!0,setTimeout(()=>r=!1,t))}}static escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}static formatDate(e){if(!e)return"";let t=new Date(e),l=Math.floor((new Date-t)/1e3),m=Math.floor(l/60),b=Math.floor(m/60),d=Math.floor(b/24);return l<60?"Just now":m<60?`${m}m ago`:b<24?`${b}h ago`:d<7?`${d}d ago`:t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}static formatContent(e){return this.escapeHtml(e).replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>')}static validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static validateComment(e){let t=[];return(!e.author_name||e.author_name.trim().length<2)&&t.push("Name must be at least 2 characters long"),(!e.author_email||!this.validateEmail(e.author_email))&&t.push("Please enter a valid email address"),(!e.content||e.content.trim().length<10)&&t.push("Comment must be at least 10 characters long"),e.content&&e.content.length>2e3&&t.push("Comment must be less than 2000 characters"),{isValid:t.length===0,errors:t}}static showNotification(e,t="info",r=3e3){let l=document.createElement("div");l.className=`notification notification-${t}`,l.textContent=e,Object.assign(l.style,{position:"fixed",top:"20px",right:"20px",padding:"12px 16px",borderRadius:"4px",color:"white",fontSize:"14px",zIndex:"10000",opacity:"0",transform:"translateY(-20px)",transition:"all 0.3s ease",maxWidth:"300px",wordWrap:"break-word"});let m={success:"#28a745",error:"#dc3545",warning:"#ffc107",info:"#007bff"};l.style.backgroundColor=m[t]||m.info,document.body.appendChild(l),setTimeout(()=>{l.style.opacity="1",l.style.transform="translateY(0)"},10),setTimeout(()=>{l.style.opacity="0",l.style.transform="translateY(-20px)",setTimeout(()=>{l.parentNode&&l.parentNode.removeChild(l)},300)},r)}static copyToClipboard(e){if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(e);{let t=document.createElement("textarea");return t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select(),new Promise((r,l)=>{document.execCommand("copy")?r():l(new Error("Failed to copy text")),document.body.removeChild(t)})}}static getViewportSize(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}}static isMobile(){return this.getViewportSize().width<768}static isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0}static scrollToElement(e,t=0){if(!e)return;let l=e.getBoundingClientRect().top+window.pageYOffset-t;window.scrollTo({top:l,behavior:"smooth"})}static animateElement(e,t,r=300){return e?new Promise(l=>{e.style.animation=`${t} ${r}ms ease`,setTimeout(()=>{e.style.animation="",l()},r)}):Promise.resolve()}static deepClone(e){if(e===null||typeof e!="object")return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array)return e.map(t=>this.deepClone(t));if(typeof e=="object"){let t={};return Object.keys(e).forEach(r=>{t[r]=this.deepClone(e[r])}),t}}static sleep(e){return new Promise(t=>setTimeout(t,e))}};var ie=`/**
 * Enhanced Widget Styles with CSS Variables
 * Integrates with the dashboard theme system
 */

/* CSS Variables for theme integration */
:root {
    /* Widget-specific variables that sync with dashboard themes */
    --widget-primary: #007cba;
    --widget-secondary: #6c757d;
    --widget-success: #28a745;
    --widget-danger: #dc3545;
    --widget-warning: #ffc107;
    --widget-info: #17a2b8;
    --widget-light: #f8f9fa;
    --widget-dark: #343a40;
    --widget-background: #ffffff;
    --widget-surface: #f8f9fa;
    --widget-text: #333333;
    --widget-text-muted: #6c757d;
    --widget-border: #e0e0e0;
    --widget-shadow: rgba(0,0,0,0.1);

    /* Typography */
    --widget-font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    --widget-font-size: 16px;
    --widget-font-weight: 400;

    /* Spacing */
    --widget-spacing-xs: 0.25rem;
    --widget-spacing-sm: 0.5rem;
    --widget-spacing-md: 1rem;
    --widget-spacing-lg: 1.5rem;
    --widget-spacing-xl: 2rem;

    /* Design tokens */
    --widget-border-radius: 8px;
    --widget-transition: all 0.3s ease;
    --widget-transition-duration: 0.3s;
    --widget-transition-easing: ease-in-out;
}

/* Base widget container */
.comment-widget {
    font-family: var(--widget-font-family);
    max-width: 680px;
    margin: 2rem auto;
    padding: 1.5rem;
    background: var(--widget-background);
    border: 1px solid var(--widget-border);
    border-radius: var(--widget-border-radius);
    box-shadow: 0 2px 10px var(--widget-shadow);
    color: var(--widget-text);
    transition: var(--widget-transition);
    position: relative;
    overflow: hidden;
}

/* Header section */
.comment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--widget-border);
}

.comment-header h3 {
    margin: 0;
    color: var(--widget-text);
    font-size: 1.5rem;
    font-weight: 600;
}

.theme-selector {
    padding: 0.5rem;
    border: 1px solid var(--widget-border);
    border-radius: var(--widget-border-radius);
    background: var(--widget-surface);
    color: var(--widget-text);
    font-size: 0.9rem;
    transition: var(--widget-transition);
}

.theme-selector:focus {
    border-color: var(--widget-primary);
    box-shadow: 0 0 0 0.2rem rgba(0, 124, 186, 0.25);
}

/* Form section */
.comment-form {
    background: var(--widget-surface);
    padding: 1.5rem;
    border-radius: var(--widget-border-radius);
    margin-bottom: 2rem;
    border: 1px solid var(--widget-border);
}

.form-group {
    margin-bottom: 1rem;
}

.form-group input,
.form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--widget-border);
    border-radius: var(--widget-border-radius);
    font-size: 1rem;
    box-sizing: border-box;
    font-family: inherit;
    background: var(--widget-surface);
    color: var(--widget-text);
    transition: var(--widget-transition);
}

.form-group input:focus,
.form-group textarea:focus {
    border-color: var(--widget-primary);
    box-shadow: 0 0 0 0.2rem rgba(0, 124, 186, 0.25);
    outline: none;
}

.form-group textarea {
    min-height: 100px;
    resize: vertical;
}

.form-actions {
    text-align: right;
}

.submit-btn {
    background: var(--widget-primary);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: var(--widget-border-radius);
    font-size: 1rem;
    cursor: pointer;
    transition: var(--widget-transition);
    font-weight: 500;
}

.submit-btn:hover {
    background: var(--widget-primary);
    opacity: 0.9;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px var(--widget-shadow);
}

.submit-btn:active {
    transform: translateY(0);
}

.submit-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

/* Comments list */
.comment-list {
    margin-top: 1.5rem;
}

.comment-item {
    display: flex;
    padding: 1rem;
    margin-bottom: 1rem;
    background: var(--widget-surface);
    border: 1px solid var(--widget-border);
    border-radius: var(--widget-border-radius);
    border-left: 3px solid var(--widget-primary);
    transition: var(--widget-transition);
    position: relative;
}

.comment-item:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px var(--widget-shadow);
    border-left-color: var(--widget-primary);
}

.comment-item.level-0 {
    border-left-color: var(--widget-primary);
}

.comment-item.level-1 {
    margin-left: 2rem;
    border-left-width: 2px;
    border-left-color: var(--widget-secondary);
}

.comment-item.level-2 {
    margin-left: 3rem;
    border-left-width: 1px;
    border-left-color: var(--widget-border);
}

/* Avatar */
.comment-avatar {
    margin-right: 1rem;
    flex-shrink: 0;
}

.avatar-placeholder {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--widget-primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.1rem;
    transition: var(--widget-transition);
}

.comment-item:hover .avatar-placeholder {
    transform: scale(1.1);
}

/* Comment content */
.comment-content {
    flex: 1;
}

.comment-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}

.comment-author {
    font-weight: 600;
    color: var(--widget-primary);
}

.comment-date {
    color: var(--widget-text-muted);
}

.comment-text {
    line-height: 1.6;
    color: var(--widget-text);
    margin-bottom: 0.5rem;
}

.comment-actions {
    font-size: 0.8rem;
}

.reply-btn {
    background: none;
    border: none;
    color: var(--widget-primary);
    cursor: pointer;
    text-decoration: underline;
    font-size: 0.8rem;
    transition: var(--widget-transition);
}

.reply-btn:hover {
    color: var(--widget-primary);
    opacity: 0.8;
}

/* Nested replies */
.comment-replies {
    margin-top: 1rem;
    margin-left: 1rem;
    border-left: 2px solid var(--widget-border);
    padding-left: 1rem;
}

/* State indicators */
.loading-state,
.error-state,
.empty-state {
    text-align: center;
    padding: 2rem;
    font-style: italic;
}

.loading-state {
    color: var(--widget-text-muted);
}

.error-state {
    color: var(--widget-danger);
    background: rgba(220, 53, 69, 0.1);
    border: 1px solid var(--widget-danger);
    border-radius: var(--widget-border-radius);
}

.empty-state {
    color: var(--widget-text-muted);
}

.spinner {
    border: 3px solid var(--widget-light);
    border-top: 3px solid var(--widget-primary);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Responsive design */
@media (max-width: 768px) {
    .comment-widget {
        margin: 1rem;
        padding: 1rem;
    }

    .comment-item.level-1,
    .comment-item.level-2 {
        margin-left: 1rem;
    }

    .theme-selector {
        margin-top: 0.5rem;
        width: 100%;
    }

    .comment-header {
        flex-direction: column;
        align-items: stretch;
    }

    .comment-meta {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.25rem;
    }
}

/* Animation classes */
.fade-in {
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.slide-in {
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from { opacity: 0; transform: translateX(-20px); }
    to { opacity: 1; transform: translateX(0); }
}

/* Theme transition effects */
.theme-transitioning .comment-widget {
    transform: scale(0.98);
    opacity: 0.9;
}

.theme-transitioning .comment-item {
    transform: translateY(2px);
    opacity: 0.8;
}

.theme-transitioning .submit-btn {
    transform: scale(0.95);
}

/* Accessibility improvements */
.comment-widget:focus-within {
    outline: 2px solid var(--widget-primary);
    outline-offset: 2px;
}

.reply-btn:focus,
.submit-btn:focus,
.theme-selector:focus {
    outline: 2px solid var(--widget-primary);
    outline-offset: 2px;
}

/* Screen reader only content */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* Focus management */
.comment-item:focus-within {
    outline: 2px solid var(--widget-primary);
    outline-offset: 2px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .comment-widget {
        border: 2px solid;
    }

    .comment-item {
        border: 1px solid;
    }

    .reply-btn {
        border: 2px solid;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    .comment-widget,
    .comment-item,
    .submit-btn,
    .reply-btn {
        transition: none;
    }

    .fade-in,
    .slide-in {
        animation: none;
    }
}

/* Print styles */
@media print {
    .comment-widget {
        box-shadow: none;
        border: 1px solid #ccc;
    }

    .theme-selector,
    .reply-btn {
        display: none;
    }
}`;var U=class extends HTMLElement{constructor(){super(),this.threadId=this.getAttribute("thread-id")||Y.generateThreadId(),this.apiBaseUrl=this.getAttribute("api-base-url")||"https://comment-widget-backend.vercel.app",this.theme=this.getAttribute("theme")||"default",this.maxDepth=parseInt(this.getAttribute("max-depth"))||3,this.showThemeSelector=this.hasAttribute("show-theme-selector")||!0,this.api=new M(this.apiBaseUrl),this.renderer=new O,this.themeManager=new H(this.theme),this.comments=[],this.loading=!1,this.error=null,this.replyingTo=null,this.shadow=this.attachShadow({mode:"open"}),this.init()}async init(){try{this.loading=!0,this.render(),await this.loadComments(),this.loading=!1,this.render()}catch(e){console.error("Widget initialization error:",e),this.error=e.message,this.loading=!1,this.render()}}async loadComments(){try{let e=await this.api.getComments(this.threadId);this.comments=e.comments||[]}catch(e){console.error("Error loading comments:",e),this.error="Failed to load comments"}}async submitComment(e){try{this.loading=!0,this.render();let t=await this.api.createComment({thread_id:parseInt(this.threadId),author_name:e.author_name,author_email:e.author_email,content:e.content,parent_id:e.parent_id||null});await this.loadComments(),this.loading=!1,this.render();let r=e.parent_id?"Your reply has been posted successfully":"Your comment has been posted successfully";return this.announceToScreenReader(r),t}catch(t){throw console.error("Error submitting comment:",t),this.error=t.message,this.loading=!1,this.render(),this.announceToScreenReader("Error posting comment: "+t.message),t}}setTheme(e){this.theme=e,this.themeManager.setTheme(e),this.render()}connectedCallback(){document.addEventListener("themeChange",e=>{e.detail&&e.detail.theme&&(this.setAttribute("theme",e.detail.theme),this.setTheme(e.detail.theme))})}render(){let e=this.themeManager.getStyles(),t=this.renderer.render({comments:this.comments,loading:this.loading,error:this.error,theme:this.theme,maxDepth:this.maxDepth,showThemeSelector:this.showThemeSelector,replyingTo:this.replyingTo,onSubmit:r=>this.submitComment(r),onReply:r=>this.startReply(r),onCancelReply:()=>this.cancelReply(),onThemeChange:r=>this.setTheme(r)});this.shadow.innerHTML=`
            <style>${ie}${e}</style>
            ${t}
        `,this.attachEventListeners()}refresh(){this.loadComments()}getComments(){return this.comments}getTheme(){return this.theme}startReply(e){this.replyingTo=e,this.render(),setTimeout(()=>{let t=this.shadow.getElementById("author-name");t&&(t.focus(),this.announceToScreenReader("Reply form opened. Enter your name to continue."))},100)}cancelReply(){this.replyingTo=null,this.render(),this.announceToScreenReader("Reply cancelled.")}attachEventListeners(){this.shadow.querySelectorAll(".reply-btn").forEach(m=>{m.addEventListener("click",b=>{let d=parseInt(b.target.getAttribute("data-parent-id"));this.startReply(d)})});let t=this.shadow.getElementById("cancel-reply-btn");t&&t.addEventListener("click",()=>{this.cancelReply()});let r=this.shadow.getElementById("theme-selector");r&&r.addEventListener("change",m=>{this.setTheme(m.target.value),this.announceThemeChange(m.target.value)});let l=this.shadow.getElementById("comment-form");l&&l.addEventListener("submit",async m=>{m.preventDefault();let b=new FormData(l),d={author_name:b.get("author-name"),author_email:b.get("author-email"),content:b.get("comment-content"),parent_id:this.replyingTo};await this.submitComment(d),l.reset(),this.cancelReply()}),this.setupKeyboardNavigation()}setupKeyboardNavigation(){let e=this.shadow.querySelector(".comment-widget");e.addEventListener("keydown",t=>{let r=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),l=Array.from(r),m=l.indexOf(document.activeElement);switch(t.key){case"ArrowDown":if(t.ctrlKey){t.preventDefault();let b=(m+1)%l.length;l[b].focus()}break;case"ArrowUp":if(t.ctrlKey){t.preventDefault();let b=m-1<0?l.length-1:m-1;l[b].focus()}break;case"Home":t.ctrlKey&&(t.preventDefault(),l[0].focus());break;case"End":t.ctrlKey&&(t.preventDefault(),l[l.length-1].focus());break}})}announceThemeChange(e){let t=`Theme changed to ${e}`;this.announceToScreenReader(t)}announceToScreenReader(e){let t=document.createElement("div");t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.textContent=e,this.shadow.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},1e3)}};customElements.define("comment-widget",U);document.addEventListener("DOMContentLoaded",()=>{console.log("Comment Widget v2.0 loaded")});typeof module<"u"&&module.exports&&(module.exports={CommentWidget:U});})();
