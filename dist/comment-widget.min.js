var CommentWidget=(()=>{var se=Object.create;var X=Object.defineProperty;var de=Object.getOwnPropertyDescriptor;var ce=Object.getOwnPropertyNames;var le=Object.getPrototypeOf,me=Object.prototype.hasOwnProperty;var J=(h=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(h,{get:(e,t)=>(typeof require<"u"?require:e)[t]}):h)(function(h){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+h+'" is not supported')});var V=(h,e)=>()=>(e||h((e={exports:{}}).exports,e),e.exports);var he=(h,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of ce(e))!me.call(h,i)&&i!==t&&X(h,i,{get:()=>e[i],enumerable:!(r=de(e,i))||r.enumerable});return h};var Z=(h,e,t)=>(t=h!=null?se(le(h)):{},he(e||!h||!h.__esModule?X(t,"default",{value:h,enumerable:!0}):t,h));var ee=V(()=>{});var re=V((q,te)=>{(function(h,e){typeof q=="object"?te.exports=q=e():typeof define=="function"&&define.amd?define([],e):h.CryptoJS=e()})(q,function(){var h=h||function(e,t){var r;if(typeof window<"u"&&window.crypto&&(r=window.crypto),typeof self<"u"&&self.crypto&&(r=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(r=globalThis.crypto),!r&&typeof window<"u"&&window.msCrypto&&(r=window.msCrypto),!r&&typeof global<"u"&&global.crypto&&(r=global.crypto),!r&&typeof J=="function")try{r=ee()}catch{}var i=function(){if(r){if(typeof r.getRandomValues=="function")try{return r.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof r.randomBytes=="function")try{return r.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},m=Object.create||function(){function o(){}return function(l){var f;return o.prototype=l,f=new o,o.prototype=null,f}}(),b={},a=b.lib={},E=a.Base=function(){return{extend:function(o){var l=m(this);return o&&l.mixIn(o),(!l.hasOwnProperty("init")||this.init===l.init)&&(l.init=function(){l.$super.init.apply(this,arguments)}),l.init.prototype=l,l.$super=this,l},create:function(){var o=this.extend();return o.init.apply(o,arguments),o},init:function(){},mixIn:function(o){for(var l in o)o.hasOwnProperty(l)&&(this[l]=o[l]);o.hasOwnProperty("toString")&&(this.toString=o.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),v=a.WordArray=E.extend({init:function(o,l){o=this.words=o||[],l!=t?this.sigBytes=l:this.sigBytes=o.length*4},toString:function(o){return(o||C).stringify(this)},concat:function(o){var l=this.words,f=o.words,u=this.sigBytes,w=o.sigBytes;if(this.clamp(),u%4)for(var y=0;y<w;y++){var A=f[y>>>2]>>>24-y%4*8&255;l[u+y>>>2]|=A<<24-(u+y)%4*8}else for(var _=0;_<w;_+=4)l[u+_>>>2]=f[_>>>2];return this.sigBytes+=w,this},clamp:function(){var o=this.words,l=this.sigBytes;o[l>>>2]&=4294967295<<32-l%4*8,o.length=e.ceil(l/4)},clone:function(){var o=E.clone.call(this);return o.words=this.words.slice(0),o},random:function(o){for(var l=[],f=0;f<o;f+=4)l.push(i());return new v.init(l,o)}}),x=b.enc={},C=x.Hex={stringify:function(o){for(var l=o.words,f=o.sigBytes,u=[],w=0;w<f;w++){var y=l[w>>>2]>>>24-w%4*8&255;u.push((y>>>4).toString(16)),u.push((y&15).toString(16))}return u.join("")},parse:function(o){for(var l=o.length,f=[],u=0;u<l;u+=2)f[u>>>3]|=parseInt(o.substr(u,2),16)<<24-u%8*4;return new v.init(f,l/2)}},S=x.Latin1={stringify:function(o){for(var l=o.words,f=o.sigBytes,u=[],w=0;w<f;w++){var y=l[w>>>2]>>>24-w%4*8&255;u.push(String.fromCharCode(y))}return u.join("")},parse:function(o){for(var l=o.length,f=[],u=0;u<l;u++)f[u>>>2]|=(o.charCodeAt(u)&255)<<24-u%4*8;return new v.init(f,l)}},p=x.Utf8={stringify:function(o){try{return decodeURIComponent(escape(S.stringify(o)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(o){return S.parse(unescape(encodeURIComponent(o)))}},g=a.BufferedBlockAlgorithm=E.extend({reset:function(){this._data=new v.init,this._nDataBytes=0},_append:function(o){typeof o=="string"&&(o=p.parse(o)),this._data.concat(o),this._nDataBytes+=o.sigBytes},_process:function(o){var l,f=this._data,u=f.words,w=f.sigBytes,y=this.blockSize,A=y*4,_=w/A;o?_=e.ceil(_):_=e.max((_|0)-this._minBufferSize,0);var F=_*y,$=e.min(F*4,w);if(F){for(var M=0;M<F;M+=y)this._doProcessBlock(u,M);l=u.splice(0,F),f.sigBytes-=$}return new v.init(l,$)},clone:function(){var o=E.clone.call(this);return o._data=this._data.clone(),o},_minBufferSize:0}),k=a.Hasher=g.extend({cfg:E.extend(),init:function(o){this.cfg=this.cfg.extend(o),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(o){return this._append(o),this._process(),this},finalize:function(o){o&&this._append(o);var l=this._doFinalize();return l},blockSize:512/32,_createHelper:function(o){return function(l,f){return new o.init(f).finalize(l)}},_createHmacHelper:function(o){return function(l,f){return new T.HMAC.init(o,f).finalize(l)}}}),T=b.algo={};return b}(Math);return h})});var ie=V((U,oe)=>{(function(h,e){typeof U=="object"?oe.exports=U=e(re()):typeof define=="function"&&define.amd?define(["./core"],e):e(h.CryptoJS)})(U,function(h){return function(e){var t=h,r=t.lib,i=r.WordArray,m=r.Hasher,b=t.algo,a=[];(function(){for(var p=0;p<64;p++)a[p]=e.abs(e.sin(p+1))*4294967296|0})();var E=b.MD5=m.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(p,g){for(var k=0;k<16;k++){var T=g+k,o=p[T];p[T]=(o<<8|o>>>24)&16711935|(o<<24|o>>>8)&4278255360}var l=this._hash.words,f=p[g+0],u=p[g+1],w=p[g+2],y=p[g+3],A=p[g+4],_=p[g+5],F=p[g+6],$=p[g+7],M=p[g+8],D=p[g+9],L=p[g+10],N=p[g+11],B=p[g+12],I=p[g+13],P=p[g+14],z=p[g+15],n=l[0],s=l[1],d=l[2],c=l[3];n=v(n,s,d,c,f,7,a[0]),c=v(c,n,s,d,u,12,a[1]),d=v(d,c,n,s,w,17,a[2]),s=v(s,d,c,n,y,22,a[3]),n=v(n,s,d,c,A,7,a[4]),c=v(c,n,s,d,_,12,a[5]),d=v(d,c,n,s,F,17,a[6]),s=v(s,d,c,n,$,22,a[7]),n=v(n,s,d,c,M,7,a[8]),c=v(c,n,s,d,D,12,a[9]),d=v(d,c,n,s,L,17,a[10]),s=v(s,d,c,n,N,22,a[11]),n=v(n,s,d,c,B,7,a[12]),c=v(c,n,s,d,I,12,a[13]),d=v(d,c,n,s,P,17,a[14]),s=v(s,d,c,n,z,22,a[15]),n=x(n,s,d,c,u,5,a[16]),c=x(c,n,s,d,F,9,a[17]),d=x(d,c,n,s,N,14,a[18]),s=x(s,d,c,n,f,20,a[19]),n=x(n,s,d,c,_,5,a[20]),c=x(c,n,s,d,L,9,a[21]),d=x(d,c,n,s,z,14,a[22]),s=x(s,d,c,n,A,20,a[23]),n=x(n,s,d,c,D,5,a[24]),c=x(c,n,s,d,P,9,a[25]),d=x(d,c,n,s,y,14,a[26]),s=x(s,d,c,n,M,20,a[27]),n=x(n,s,d,c,I,5,a[28]),c=x(c,n,s,d,w,9,a[29]),d=x(d,c,n,s,$,14,a[30]),s=x(s,d,c,n,B,20,a[31]),n=C(n,s,d,c,_,4,a[32]),c=C(c,n,s,d,M,11,a[33]),d=C(d,c,n,s,N,16,a[34]),s=C(s,d,c,n,P,23,a[35]),n=C(n,s,d,c,u,4,a[36]),c=C(c,n,s,d,A,11,a[37]),d=C(d,c,n,s,$,16,a[38]),s=C(s,d,c,n,L,23,a[39]),n=C(n,s,d,c,I,4,a[40]),c=C(c,n,s,d,f,11,a[41]),d=C(d,c,n,s,y,16,a[42]),s=C(s,d,c,n,F,23,a[43]),n=C(n,s,d,c,D,4,a[44]),c=C(c,n,s,d,B,11,a[45]),d=C(d,c,n,s,z,16,a[46]),s=C(s,d,c,n,w,23,a[47]),n=S(n,s,d,c,f,6,a[48]),c=S(c,n,s,d,$,10,a[49]),d=S(d,c,n,s,P,15,a[50]),s=S(s,d,c,n,_,21,a[51]),n=S(n,s,d,c,B,6,a[52]),c=S(c,n,s,d,y,10,a[53]),d=S(d,c,n,s,L,15,a[54]),s=S(s,d,c,n,u,21,a[55]),n=S(n,s,d,c,M,6,a[56]),c=S(c,n,s,d,z,10,a[57]),d=S(d,c,n,s,F,15,a[58]),s=S(s,d,c,n,I,21,a[59]),n=S(n,s,d,c,A,6,a[60]),c=S(c,n,s,d,N,10,a[61]),d=S(d,c,n,s,w,15,a[62]),s=S(s,d,c,n,D,21,a[63]),l[0]=l[0]+n|0,l[1]=l[1]+s|0,l[2]=l[2]+d|0,l[3]=l[3]+c|0},_doFinalize:function(){var p=this._data,g=p.words,k=this._nDataBytes*8,T=p.sigBytes*8;g[T>>>5]|=128<<24-T%32;var o=e.floor(k/4294967296),l=k;g[(T+64>>>9<<4)+15]=(o<<8|o>>>24)&16711935|(o<<24|o>>>8)&4278255360,g[(T+64>>>9<<4)+14]=(l<<8|l>>>24)&16711935|(l<<24|l>>>8)&4278255360,p.sigBytes=(g.length+1)*4,this._process();for(var f=this._hash,u=f.words,w=0;w<4;w++){var y=u[w];u[w]=(y<<8|y>>>24)&16711935|(y<<24|y>>>8)&4278255360}return f},clone:function(){var p=m.clone.call(this);return p._hash=this._hash.clone(),p}});function v(p,g,k,T,o,l,f){var u=p+(g&k|~g&T)+o+f;return(u<<l|u>>>32-l)+g}function x(p,g,k,T,o,l,f){var u=p+(g&T|k&~T)+o+f;return(u<<l|u>>>32-l)+g}function C(p,g,k,T,o,l,f){var u=p+(g^k^T)+o+f;return(u<<l|u>>>32-l)+g}function S(p,g,k,T,o,l,f){var u=p+(k^(g|~T))+o+f;return(u<<l|u>>>32-l)+g}t.MD5=m._createHelper(E),t.HmacMD5=m._createHmacHelper(E)}(Math),h.MD5})});var O=class{constructor(e="https://comment-widget-backend.vercel.app"){this.baseUrl=e,this.defaultHeaders={"Content-Type":"application/json"}}async request(e,t={}){let r=`${this.baseUrl}${e}`,i={headers:{...this.defaultHeaders,...t.headers},...t};try{let m=await fetch(r,i);if(!m.ok){let b=await m.json().catch(()=>({}));throw new Error(b.detail||`HTTP ${m.status}: ${m.statusText}`)}return await m.json()}catch(m){throw m.name==="TypeError"&&m.message.includes("fetch")?new Error("Network error: Unable to connect to API"):m}}async getComments(e,t={}){let r=new URLSearchParams({thread_id:e,...t});return this.request(`/widget/comments/${e}?${r}`)}async createComment(e){return this.request("/comments",{method:"POST",body:JSON.stringify(e)})}async updateComment(e,t){return this.request(`/comments/${e}`,{method:"PUT",body:JSON.stringify(t)})}async deleteComment(e){return this.request(`/comments/${e}`,{method:"DELETE"})}async moderateComment(e,t){return this.request(`/comments/${e}/moderate`,{method:"PUT",body:JSON.stringify(t)})}async getThread(e){return this.request(`/threads/${e}`)}async createThread(e){return this.request("/threads",{method:"POST",body:JSON.stringify(e)})}async getDemoThread(){return this.request("/demo/thread")}async healthCheck(){return this.request("/health")}};var K=Z(J("dompurify"),1),ue={ALLOWED_TAGS:["p","br","strong","em","a","code"],ALLOWED_ATTR:{a:["href","rel"]},ALLOW_UNKNOWN_PROTOCOLS:!1,ALLOWED_URI_REGEXP:/^https?:\/\//i,FORBID_ATTR:["target","style","onerror","onclick","onload","id","class","name"],FORBID_TAGS:["script","iframe","object","embed","style","img"],RETURN_TRUSTED_TYPE:!0,KEEP_CONTENT:!1,SANITIZE_DOM:!0,WHOLE_DOCUMENT:!1,FORCE_BODY:!0,HOOKS:{afterSanitizeAttributes:function(h){if(h.tagName==="A"){h.setAttribute("rel","noopener noreferrer nofollow ugc"),h.removeAttribute("target");let e=h.getAttribute("href");e&&!/^https?:\/\//i.test(e)&&h.removeAttribute("href")}}}},fe={ALLOWED_TAGS:[],ALLOWED_ATTR:{},KEEP_CONTENT:!0,RETURN_TRUSTED_TYPE:!1};function Q(h,e={}){if(!h)return"";let{allowHTML:t=!1,allowLinks:r=!1,convertNewlines:i=!0,maxLength:m=5e3}=e;h.length>m&&(h=h.substring(0,m));let b;if(!t)b=K.default.sanitize(h,fe),i&&(b=b.replace(/\n/g,"<br>"));else{let E={...ue};r||(E.ALLOWED_TAGS=E.ALLOWED_TAGS.filter(v=>v!=="a"),E.ALLOWED_ATTR={}),b=K.default.sanitize(h,E)}let a=[/javascript:/gi,/data:text\/html/gi,/vbscript:/gi,/on\w+\s*=/gi,/<script/gi,/<iframe/gi];for(let E of a)if(E.test(b))return console.error("[Security] Blocked malicious comment content"),"[Comment removed for security]";return b}var H=class{constructor(){this.templates={widget:e=>`
                <div class="comment-widget" data-theme="${e.theme}" role="region" aria-label="Comment widget">
                    <div class="comment-header">
                        <h3>\u{1F4AC} Comments</h3>
                        ${e.showThemeSelector?this.renderThemeSelector(e.theme,e.onThemeChange):""}
                    </div>

                    ${e.error?this.renderError(e.error):""}

                    ${e.loading?this.renderLoading():""}

                    ${!e.loading&&!e.error?this.renderCommentForm(e.onSubmit,e.replyingTo,e.onCancelReply):""}

                    <div class="comment-list" role="region" aria-label="Comments list">
                        ${e.comments.length>0?e.comments.map(t=>this.renderComment(t,0,e.maxDepth,e.onReply)).join(""):this.renderEmptyState()}
                    </div>
                </div>
            `,comment:(e,t,r,i)=>`
                <article class="comment-item level-${t}" data-id="${e.id}" style="margin-left: ${t*20}px;" role="article" aria-labelledby="comment-author-${e.id}" aria-describedby="comment-content-${e.id}">
                    <div class="comment-avatar">
                        <div class="avatar-placeholder" aria-hidden="true">
                            ${e.author_name.charAt(0).toUpperCase()}
                        </div>
                    </div>
                    <div class="comment-content">
                        <div class="comment-meta">
                            <span class="comment-author" id="comment-author-${e.id}">${this.escapeHtml(e.author_name)}</span>
                            <time class="comment-date" datetime="${e.created_at}" aria-label="Posted ${this.formatDate(e.created_at)}">${this.formatDate(e.created_at)}</time>
                        </div>
                        <div class="comment-text" id="comment-content-${e.id}">${this.formatContent(e.content)}</div>
                        <div class="comment-actions">
                            ${t<r?`<button class="reply-btn" data-parent-id="${e.id}" aria-label="Reply to ${this.escapeHtml(e.author_name)}'s comment">Reply</button>`:""}
                        </div>
                        ${e.replies&&e.replies.length>0?`<div class="comment-replies" role="region" aria-label="Replies to this comment">${e.replies.map(m=>this.renderComment(m,t+1,r,i)).join("")}</div>`:""}
                    </div>
                </article>
            `,form:(e,t,r)=>`
                <form class="comment-form" id="comment-form" role="form" aria-label="${t?"Reply to comment":"Add new comment"}">
                    ${t?`<div class="reply-indicator" role="status" aria-live="polite">Replying to comment #${t}</div>`:""}
                    <div class="form-group">
                        <input type="text" id="author-name" name="author-name" placeholder="Your name" required aria-label="Your name" aria-required="true">
                    </div>
                    <div class="form-group">
                        <input type="email" id="author-email" name="author-email" placeholder="Your email" required aria-label="Your email address" aria-required="true" aria-describedby="email-help">
                        <div id="email-help" class="sr-only">Your email will not be published</div>
                    </div>
                    <div class="form-group">
                        <textarea id="comment-content" name="comment-content" placeholder="${t?"Write your reply...":"Write your comment..."}" required rows="4" aria-label="${t?"Write your reply":"Write your comment"}" aria-required="true"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="submit-btn" aria-describedby="submit-help">${t?"Post Reply":"Post Comment"}</button>
                        ${t?'<button type="button" class="cancel-reply-btn" id="cancel-reply-btn" aria-label="Cancel reply">Cancel Reply</button>':""}
                        <div id="submit-help" class="sr-only">Submit your ${t?"reply":"comment"}</div>
                    </div>
                </form>
            `,themeSelector:(e,t)=>`
                <label for="theme-selector" class="sr-only">Choose theme</label>
                <select class="theme-selector" id="theme-selector" aria-label="Select comment widget theme">
                    <option value="default" ${e==="default"?"selected":""}>Default</option>
                    <option value="dark" ${e==="dark"?"selected":""}>Dark</option>
                    <option value="matrix" ${e==="matrix"?"selected":""}>Matrix</option>
                    <option value="neocities" ${e==="neocities"?"selected":""}>NeoCities</option>
                    <option value="serene-mist" ${e==="serene-mist"?"selected":""}>Serene Mist</option>
                    <option value="neon-pulse" ${e==="neon-pulse"?"selected":""}>Neon Pulse</option>
                    <option value="geometric-prime" ${e==="geometric-prime"?"selected":""}>Geometric Prime</option>
                    <option value="forest-flow" ${e==="forest-flow"?"selected":""}>Forest Flow</option>
                    <option value="digital-chaos" ${e==="digital-chaos"?"selected":""}>Digital Chaos</option>
                </select>
            `,loading:()=>`
                <div class="loading-state">
                    <div class="spinner"></div>
                    <p>Loading comments...</p>
                </div>
            `,error:e=>`
                <div class="error-state">
                    <p>\u274C ${this.escapeHtml(e)}</p>
                </div>
            `,empty:()=>`
                <div class="empty-state">
                    <p>\u{1F4AD} No comments yet. Be the first to comment!</p>
                </div>
            `}}render(e){return this.templates.widget(e)}renderComment(e,t,r){return this.templates.comment(e,t,r)}renderCommentForm(e,t,r){return this.templates.form(e,t,r)}enhanceFormAccessibility(e){if(!e)return;let t=e.querySelector('input[name="author-name"]');t&&(t.setAttribute("aria-label","Your name"),t.setAttribute("aria-required","true"));let r=e.querySelector('input[name="author-email"]');r&&(r.setAttribute("aria-label","Your email address"),r.setAttribute("aria-required","true"),r.setAttribute("aria-describedby","email-help"));let i=e.querySelector('textarea[name="comment-content"]');i&&(i.setAttribute("aria-label",replyingTo?"Write your reply":"Write your comment"),i.setAttribute("aria-required","true"));let m=document.createElement("div");m.id="email-help",m.className="sr-only",m.textContent="Your email will not be published",e.appendChild(m)}renderThemeSelector(e,t){return this.templates.themeSelector(e,t)}renderLoading(){return this.templates.loading()}renderError(e){return this.templates.error(e)}renderEmptyState(){return this.templates.empty()}formatDate(e){if(!e)return"";let t=new Date(e),i=Math.floor((new Date-t)/(1e3*60*60));return i<1?"Just now":i<24?`${i}h ago`:t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}formatContent(e){return Q(e,{allowHTML:!1,convertNewlines:!0})}escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}};var W=class{constructor(e="default"){this.currentTheme=e,this.themes={default:this.getDefaultTheme(),dark:this.getDarkTheme(),matrix:this.getMatrixTheme(),neocities:this.getNeocitiesTheme(),"serene-mist":this.getSereneMistTheme(),"neon-pulse":this.getNeonPulseTheme(),"geometric-prime":this.getGeometricPrimeTheme(),"forest-flow":this.getForestFlowTheme(),"digital-chaos":this.getDigitalChaosTheme()},this.themeCSS=new Map,this.transitionDuration=300,this.init()}init(){document.addEventListener("themeChange",e=>{this.syncWithDashboard(e.detail.theme)}),this.loadThemeCSS()}setTheme(e,t=!0){this.themes[e]||(console.warn(`Theme "${e}" not found, falling back to default`),e="default");let r=this.currentTheme;this.currentTheme=e,this.applyTheme(t),this.dispatchThemeChange(r,e)}syncWithDashboard(e){let r={default:"default",dark:"dark",matrix:"matrix",neocities:"neocities"}[e]||"default";r!==this.currentTheme&&this.setTheme(r,!0)}applyTheme(e=!0){let t=this.themes[this.currentTheme]||this.themes.default;this.applyCSSVariables(t,e),this.applyThemeEffects(t),this.updateMetaThemeColor(t.colors.primary)}applyCSSVariables(e,t=!0){let r=document.documentElement;t?(r.style.setProperty("--widget-transition-duration",e.transitions.duration),r.style.setProperty("--widget-transition-easing",e.transitions.easing)):r.style.setProperty("--widget-transition-duration","0s"),Object.entries(e.colors).forEach(([i,m])=>{r.style.setProperty(`--widget-${i}`,m)}),Object.entries(e.fonts).forEach(([i,m])=>{r.style.setProperty(`--widget-font-${i}`,m)}),Object.entries(e.spacing).forEach(([i,m])=>{r.style.setProperty(`--widget-spacing-${i}`,m)}),r.style.setProperty("--widget-border-radius",e.borderRadius)}applyThemeEffects(e){let t=document.querySelector("comment-widget");if(t&&t.shadowRoot){let r=t.shadowRoot.querySelector("#indie-comments-app");r&&(r.className=r.className.replace(/theme-\w+/g,""),r.classList.add(`theme-${this.currentTheme}`))}switch(this.currentTheme){case"matrix":this.applyMatrixEffects();break;case"neocities":this.applyNeocitiesEffects();break;case"dark":this.applyDarkEffects();break;case"serene-mist":this.applySereneMistEffects();break;case"neon-pulse":this.applyNeonPulseEffects();break;case"geometric-prime":this.applyGeometricPrimeEffects();break;case"forest-flow":this.applyForestFlowEffects();break;case"digital-chaos":this.applyDigitalChaosEffects();break;default:this.applyDefaultEffects()}}applyMatrixEffects(){console.log("Matrix theme effects applied")}applyNeocitiesEffects(){console.log("NeoCities theme effects applied")}applyDarkEffects(){console.log("Dark theme effects applied")}applyDefaultEffects(){console.log("Default theme effects applied")}applySereneMistEffects(){this.widgetElement.style.animation="serene-breath 4s ease-in-out infinite"}applyNeonPulseEffects(){this.widgetElement.style.animation="neon-pulse 2s ease-in-out infinite"}applyGeometricPrimeEffects(){this.widgetElement.style.animation="geometric-rotate 8s linear infinite"}applyForestFlowEffects(){this.widgetElement.style.animation="forest-wave 6s ease-in-out infinite"}applyDigitalChaosEffects(){this.widgetElement.style.animation="digital-glitch 0.3s ease-in-out infinite, scan-line 2s linear infinite"}updateMetaThemeColor(e){let t=document.querySelector('meta[name="theme-color"]');t||(t=document.createElement("meta"),t.name="theme-color",document.head.appendChild(t)),t.content=e}dispatchThemeChange(e,t){document.dispatchEvent(new CustomEvent("commentWidgetThemeChange",{detail:{theme:t,previousTheme:e,config:this.themes[t]}}))}async loadThemeCSS(){let e={dark:"/frontend/static/css/themes/dark.css",matrix:"/frontend/static/css/themes/matrix.css",neocities:"/frontend/static/css/themes/neocities.css"};for(let[t,r]of Object.entries(e))try{let i=await fetch(r);if(i.ok){let m=await i.text();this.themeCSS.set(t,m)}}catch(i){console.warn(`Failed to load theme CSS for ${t}:`,i)}}getThemeCSS(e){return this.themeCSS.get(e)||""}getDefaultTheme(){return`
            /* Default theme with CSS variables */
            .comment-widget {
                font-family: var(--widget-font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
                max-width: 680px;
                margin: 2rem auto;
                padding: 1.5rem;
                background: var(--widget-background, #fff);
                border: 1px solid var(--widget-border, #e0e0e0);
                border-radius: var(--widget-border-radius, 8px);
                box-shadow: 0 2px 10px var(--widget-shadow, rgba(0,0,0,0.1));
                color: var(--widget-text, #333);
                transition: var(--widget-transition, all 0.3s ease);
            }

            .comment-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1.5rem;
                padding-bottom: 1rem;
                border-bottom: 1px solid var(--widget-border, #e0e0e0);
            }

            .comment-header h3 {
                margin: 0;
                color: var(--widget-text, #333);
                font-size: 1.5rem;
                font-weight: 600;
            }

            .theme-selector {
                padding: 0.5rem;
                border: 1px solid var(--widget-border, #ddd);
                border-radius: var(--widget-border-radius, 4px);
                background: var(--widget-surface, #fff);
                color: var(--widget-text, #333);
                font-size: 0.9rem;
            }

            .comment-form {
                background: var(--widget-surface, #f8f9fa);
                padding: 1.5rem;
                border-radius: var(--widget-border-radius, 6px);
                margin-bottom: 2rem;
                border: 1px solid var(--widget-border, #e9ecef);
            }

            .form-group {
                margin-bottom: 1rem;
            }

            .form-group input,
            .form-group textarea {
                width: 100%;
                padding: 0.75rem;
                border: 1px solid var(--widget-border, #ddd);
                border-radius: var(--widget-border-radius, 4px);
                font-size: 1rem;
                box-sizing: border-box;
                font-family: inherit;
                background: var(--widget-surface, #fff);
                color: var(--widget-text, #333);
                transition: var(--widget-transition, border-color 0.2s);
            }

            .form-group input:focus,
            .form-group textarea:focus {
                border-color: var(--widget-primary, #007cba);
                box-shadow: 0 0 0 0.2rem rgba(0, 124, 186, 0.25);
            }

            .form-group textarea {
                min-height: 100px;
                resize: vertical;
            }

            .form-actions {
                text-align: right;
            }

            .submit-btn {
                background: var(--widget-primary, #007cba);
                color: white;
                border: none;
                padding: 0.75rem 1.5rem;
                border-radius: var(--widget-border-radius, 4px);
                font-size: 1rem;
                cursor: pointer;
                transition: var(--widget-transition, background 0.2s);
            }

            .submit-btn:hover {
                background: var(--widget-primary, #007cba);
                opacity: 0.9;
                transform: translateY(-1px);
            }

            .comment-list {
                margin-top: 1.5rem;
            }

            .comment-item {
                display: flex;
                padding: 1rem;
                margin-bottom: 1rem;
                background: var(--widget-surface, #fff);
                border: 1px solid var(--widget-border, #eee);
                border-radius: var(--widget-border-radius, 6px);
                border-left: 3px solid var(--widget-primary, #007cba);
                transition: var(--widget-transition, all 0.2s);
            }

            .comment-item:hover {
                transform: translateY(-1px);
                box-shadow: 0 4px 12px var(--widget-shadow, rgba(0,0,0,0.1));
            }

            .comment-item.level-1 {
                margin-left: 2rem;
                border-left-width: 2px;
                border-left-color: var(--widget-secondary, #888);
            }

            .comment-item.level-2 {
                margin-left: 3rem;
                border-left-width: 1px;
                border-left-color: var(--widget-border, #ccc);
            }

            .comment-avatar {
                margin-right: 1rem;
                flex-shrink: 0;
            }

            .avatar-placeholder {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: var(--widget-primary, #007cba);
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 1.1rem;
            }

            .comment-content {
                flex: 1;
            }

            .comment-meta {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 0.5rem;
                font-size: 0.9rem;
            }

            .comment-author {
                font-weight: 600;
                color: var(--widget-primary, #007cba);
            }

            .comment-date {
                color: var(--widget-text-muted, #888);
            }

            .comment-text {
                line-height: 1.6;
                color: var(--widget-text, #444);
                margin-bottom: 0.5rem;
            }

            .comment-actions {
                font-size: 0.8rem;
            }

            .reply-btn {
                background: none;
                border: none;
                color: var(--widget-primary, #007cba);
                cursor: pointer;
                text-decoration: underline;
                font-size: 0.8rem;
                transition: var(--widget-transition, color 0.2s);
            }

            .reply-btn:hover {
                color: var(--widget-primary, #007cba);
                opacity: 0.8;
            }

            .comment-replies {
                margin-top: 1rem;
                margin-left: 1rem;
            }

            .loading-state,
            .error-state,
            .empty-state {
                text-align: center;
                padding: 2rem;
                font-style: italic;
            }

            .loading-state {
                color: var(--widget-text-muted, #666);
            }

            .error-state {
                color: var(--widget-danger, #dc3545);
                background: rgba(220, 53, 69, 0.1);
                border: 1px solid var(--widget-danger, #dc3545);
                border-radius: var(--widget-border-radius, 4px);
            }

            .empty-state {
                color: var(--widget-text-muted, #666);
            }

            .spinner {
                border: 3px solid var(--widget-light, #f3f3f3);
                border-top: 3px solid var(--widget-primary, #007cba);
                border-radius: 50%;
                width: 30px;
                height: 30px;
                animation: spin 1s linear infinite;
                margin: 0 auto 1rem;
            }

            @keyframes spin {
                0% { transform: rotate(0deg); }
                100% { transform: rotate(360deg); }
            }

            @media (max-width: 768px) {
                .comment-widget {
                    margin: 1rem;
                    padding: 1rem;
                }

                .comment-item.level-1,
                .comment-item.level-2 {
                    margin-left: 1rem;
                }

                .theme-selector {
                    margin-top: 0.5rem;
                    width: 100%;
                }

                .comment-header {
                    flex-direction: column;
                    align-items: stretch;
                }
            }
        `}getDarkTheme(){return`
            .comment-widget {
                background: #2d2d2d;
                border-color: #444;
                color: #e0e0e0;
                box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            }

            .comment-header h3 {
                color: #e0e0e0;
            }

            .theme-selector {
                background: #3a3a3a;
                border-color: #555;
                color: #e0e0e0;
            }

            .comment-form {
                background: #3a3a3a;
                border-color: #555;
            }

            .form-group input,
            .form-group textarea {
                background: #3a3a3a;
                border-color: #555;
                color: #e0e0e0;
            }

            .submit-btn {
                background: #4fc3f7;
                color: #000;
            }

            .submit-btn:hover {
                background: #29b6f6;
            }

            .comment-item {
                background: #2d2d2d;
                border-color: #444;
                color: #e0e0e0;
                border-left-color: #4fc3f7;
            }

            .comment-item.level-1 {
                border-left-color: #888;
            }

            .comment-item.level-2 {
                border-left-color: #ccc;
            }

            .avatar-placeholder {
                background: #4fc3f7;
                color: #000;
            }

            .comment-author {
                color: #4fc3f7;
            }

            .comment-date {
                color: #b0b0b0;
            }

            .comment-text {
                color: #e0e0e0;
            }

            .reply-btn {
                color: #4fc3f7;
            }

            .reply-btn:hover {
                color: #29b6f6;
            }

            .loading-state,
            .empty-state {
                color: #b0b0b0;
            }

            .error-state {
                color: #ff6b6b;
                background: rgba(255, 107, 107, 0.1);
                border-color: rgba(255, 107, 107, 0.3);
            }
        `}getMatrixTheme(){return`
            .comment-widget {
                background: #000;
                border-color: #0a0;
                color: #0f0;
                font-family: 'Courier New', monospace;
                box-shadow: 0 2px 10px rgba(0,255,0,0.1);
            }

            .comment-header h3 {
                color: #0f0;
            }

            .theme-selector {
                background: #010;
                border-color: #080;
                color: #0f0;
                font-family: 'Courier New', monospace;
            }

            .comment-form {
                background: #010;
                border-color: #080;
            }

            .form-group input,
            .form-group textarea {
                background: #010;
                border-color: #080;
                color: #0f0;
                font-family: 'Courier New', monospace;
            }

            .submit-btn {
                background: #0a0;
                color: #000;
                font-family: 'Courier New', monospace;
            }

            .submit-btn:hover {
                background: #0f0;
                box-shadow: 0 0 5px rgba(0, 255, 0, 0.5);
            }

            .comment-item {
                background: #000;
                border-color: #0a0;
                color: #0f0;
                border-left-color: #0f0;
                font-family: 'Courier New', monospace;
            }

            .comment-item.level-1 {
                border-left-color: #080;
            }

            .comment-item.level-2 {
                border-left-color: #040;
            }

            .avatar-placeholder {
                background: #0f0;
                color: #000;
            }

            .comment-author {
                color: #0f0;
            }

            .comment-date {
                color: #6b7280;
            }

            .comment-text {
                color: #0f0;
            }

            .reply-btn {
                color: #0f0;
            }

            .reply-btn:hover {
                color: #0a0;
                text-shadow: 0 0 3px rgba(0, 255, 0, 0.5);
            }

            .loading-state,
            .empty-state {
                color: #6b7280;
            }

            .error-state {
                color: #ff4444;
                background: rgba(255, 68, 68, 0.1);
                border-color: rgba(255, 68, 68, 0.3);
            }
        `}getNeocitiesTheme(){return`
            .comment-widget {
                background: #ccffff;
                border: 2px dashed #996699;
                color: #330033;
                box-shadow: 0 4px 15px rgba(153, 102, 153, 0.2);
            }

            .comment-header h3 {
                color: #330033;
            }

            .theme-selector {
                background: #ffff99;
                border: 2px dotted #669966;
                color: #330033;
            }

            .comment-form {
                background: #ffff99;
                border: 2px dotted #669966;
            }

            .form-group input,
            .form-group textarea {
                background: #ffff99;
                border: 2px dotted #669966;
                color: #330033;
            }

            .submit-btn {
                background: #ffccff;
                color: #330033;
                border: 2px solid #996699;
            }

            .submit-btn:hover {
                background: #ff99ff;
            }

            .comment-item {
                background: #ccffff;
                border: 2px dashed #996699;
                color: #330033;
                border-left: 4px solid #996699;
            }

            .comment-item.level-1 {
                border-left-color: #669966;
                border-left-style: dotted;
            }

            .comment-item.level-2 {
                border-left-color: #cc99ff;
                border-left-style: dashed;
            }

            .avatar-placeholder {
                background: #ffccff;
                color: #330033;
                border: 2px solid #996699;
            }

            .comment-author {
                color: #663399;
                font-weight: bold;
            }

            .comment-date {
                color: #666699;
            }

            .comment-text {
                color: #330033;
            }

            .reply-btn {
                color: #663399;
                background: #ffccff;
                border: 1px solid #996699;
                padding: 0.2rem 0.5rem;
                border-radius: 3px;
            }

            .reply-btn:hover {
                background: #ff99ff;
            }

            .loading-state,
            .empty-state {
                color: #666699;
            }

            .error-state {
                color: #cc0000;
                background: rgba(255, 204, 204, 0.7);
                border: 2px dashed #cc6666;
            }
        `}getSereneMistTheme(){return{colors:{primary:"#8B9D77",secondary:"#A8B5A0",background:"#F8F9F7",surface:"#FFFFFF",text:"#4A5D3A","text-muted":"#7A8F69",border:"#D4E2D0",light:"#F0F2EF",danger:"#C17D5F"},fonts:{family:"'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif",size:"14px",weight:"400"},spacing:{small:"8px",medium:"16px",large:"24px"},borderRadius:"12px",transitions:{duration:"0.4s",easing:"cubic-bezier(0.4, 0, 0.2, 1)"}}}getNeonPulseTheme(){return{colors:{primary:"#00FF88",secondary:"#FF0080",background:"#0A0A0A",surface:"#1A1A1A",text:"#FFFFFF","text-muted":"#888888",border:"#333333",light:"#2A2A2A",danger:"#FF4444"},fonts:{family:"'JetBrains Mono', 'Courier New', monospace",size:"14px",weight:"400"},spacing:{small:"8px",medium:"16px",large:"24px"},borderRadius:"4px",transitions:{duration:"0.2s",easing:"ease-out"}}}getGeometricPrimeTheme(){return{colors:{primary:"#FF6B35",secondary:"#F7931E",background:"#2C2C2C",surface:"#3A3A3A",text:"#FFFFFF","text-muted":"#CCCCCC",border:"#555555",light:"#4A4A4A",danger:"#FF4444"},fonts:{family:"'IBM Plex Sans', sans-serif",size:"14px",weight:"500"},spacing:{small:"12px",medium:"20px",large:"32px"},borderRadius:"0px",transitions:{duration:"0.3s",easing:"ease-in-out"}}}getForestFlowTheme(){return{colors:{primary:"#2D5A3D",secondary:"#4A7C59",background:"#F5F8F5",surface:"#FFFFFF",text:"#1A3D2A","text-muted":"#5A8F6B",border:"#B8D4BB",light:"#E8F5E8",danger:"#8B4513"},fonts:{family:"'Crimson Text', serif",size:"15px",weight:"400"},spacing:{small:"10px",medium:"18px",large:"28px"},borderRadius:"16px",transitions:{duration:"0.5s",easing:"ease-in-out"}}}getDigitalChaosTheme(){return{colors:{primary:"#FF00FF",secondary:"#00FFFF",background:"#000000",surface:"#0F0F0F",text:"#FFFFFF","text-muted":"#AAAAAA",border:"#333333",light:"#1A1A1A",danger:"#FF0000"},fonts:{family:"'Share Tech Mono', monospace",size:"13px",weight:"400"},spacing:{small:"6px",medium:"12px",large:"18px"},borderRadius:"2px",transitions:{duration:"0.1s",easing:"step-end"}}}};var ae=Z(ie(),1),Y=class{static isLocalhost(){return window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"}static generateThreadId(){return this.isLocalhost()?"demo_site":(0,ae.default)(window.location.href).toString().substring(0,16)}static generateId(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}static debounce(e,t){let r;return function(...m){let b=()=>{clearTimeout(r),e(...m)};clearTimeout(r),r=setTimeout(b,t)}}static throttle(e,t){let r;return function(){let i=arguments,m=this;r||(e.apply(m,i),r=!0,setTimeout(()=>r=!1,t))}}static escapeHtml(e){let t=document.createElement("div");return t.textContent=e,t.innerHTML}static formatDate(e){if(!e)return"";let t=new Date(e),i=Math.floor((new Date-t)/1e3),m=Math.floor(i/60),b=Math.floor(m/60),a=Math.floor(b/24);return i<60?"Just now":m<60?`${m}m ago`:b<24?`${b}h ago`:a<7?`${a}d ago`:t.toLocaleDateString()+" "+t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}static formatContent(e){return this.escapeHtml(e).replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,"<code>$1</code>").replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>')}static validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static validateComment(e){let t=[];return(!e.author_name||e.author_name.trim().length<2)&&t.push("Name must be at least 2 characters long"),(!e.author_email||!this.validateEmail(e.author_email))&&t.push("Please enter a valid email address"),(!e.content||e.content.trim().length<10)&&t.push("Comment must be at least 10 characters long"),e.content&&e.content.length>2e3&&t.push("Comment must be less than 2000 characters"),{isValid:t.length===0,errors:t}}static showNotification(e,t="info",r=3e3){let i=document.createElement("div");i.className=`notification notification-${t}`,i.textContent=e,Object.assign(i.style,{position:"fixed",top:"20px",right:"20px",padding:"12px 16px",borderRadius:"4px",color:"white",fontSize:"14px",zIndex:"10000",opacity:"0",transform:"translateY(-20px)",transition:"all 0.3s ease",maxWidth:"300px",wordWrap:"break-word"});let m={success:"#28a745",error:"#dc3545",warning:"#ffc107",info:"#007bff"};i.style.backgroundColor=m[t]||m.info,document.body.appendChild(i),setTimeout(()=>{i.style.opacity="1",i.style.transform="translateY(0)"},10),setTimeout(()=>{i.style.opacity="0",i.style.transform="translateY(-20px)",setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},300)},r)}static copyToClipboard(e){if(navigator.clipboard&&window.isSecureContext)return navigator.clipboard.writeText(e);{let t=document.createElement("textarea");return t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select(),new Promise((r,i)=>{document.execCommand("copy")?r():i(new Error("Failed to copy text")),document.body.removeChild(t)})}}static getViewportSize(){return{width:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,height:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}}static isMobile(){return this.getViewportSize().width<768}static isTouchDevice(){return"ontouchstart"in window||navigator.maxTouchPoints>0}static scrollToElement(e,t=0){if(!e)return;let i=e.getBoundingClientRect().top+window.pageYOffset-t;window.scrollTo({top:i,behavior:"smooth"})}static animateElement(e,t,r=300){return e?new Promise(i=>{e.style.animation=`${t} ${r}ms ease`,setTimeout(()=>{e.style.animation="",i()},r)}):Promise.resolve()}static deepClone(e){if(e===null||typeof e!="object")return e;if(e instanceof Date)return new Date(e.getTime());if(e instanceof Array)return e.map(t=>this.deepClone(t));if(typeof e=="object"){let t={};return Object.keys(e).forEach(r=>{t[r]=this.deepClone(e[r])}),t}}static sleep(e){return new Promise(t=>setTimeout(t,e))}};var R=class{static handle(e,t={}){return console.error("Comment Widget Error:",e,t),e.name==="NetworkError"||e.message.includes("fetch")?this.handleNetworkError(e,t):e.name==="ValidationError"?this.handleValidationError(e,t):e.status>=400&&e.status<500?this.handleClientError(e,t):e.status>=500?this.handleServerError(e,t):this.handleGenericError(e,t)}static handleNetworkError(e,t){let r="Network connection failed. Please check your internet connection.";return this.showUserMessage(r,"error"),{type:"network",message:r,retryable:!0}}static handleValidationError(e,t){let r=e.message||"Invalid input data.";return this.showUserMessage(r,"warning"),{type:"validation",message:r,retryable:!1}}static handleClientError(e,t){let r="Request failed.";return e.status===401?r="Authentication required.":e.status===403?r="Access denied.":e.status===404?r="Resource not found.":e.status===429&&(r="Too many requests. Please wait and try again."),this.showUserMessage(r,"error"),{type:"client",message:r,retryable:e.status===429}}static handleServerError(e,t){let r="Server error occurred. Please try again later.";return this.showUserMessage(r,"error"),{type:"server",message:r,retryable:!0}}static handleGenericError(e,t){let r="An unexpected error occurred.";return this.showUserMessage(r,"error"),{type:"generic",message:r,retryable:!0}}static showUserMessage(e,t="info"){let r=document.createElement("div");r.className=`comment-widget-notification comment-widget-notification--${t}`,r.textContent=e,r.setAttribute("role","alert"),r.setAttribute("aria-live","assertive"),Object.assign(r.style,{position:"fixed",top:"20px",right:"20px",background:t==="error"?"#ff4444":t==="warning"?"#ffaa00":"#44aa44",color:"white",padding:"12px 16px",borderRadius:"4px",boxShadow:"0 2px 8px rgba(0,0,0,0.3)",zIndex:"10000",maxWidth:"300px",fontFamily:"Arial, sans-serif",fontSize:"14px"}),document.body.appendChild(r),setTimeout(()=>{r.parentNode&&r.parentNode.removeChild(r)},5e3)}static async withRetry(e,t=3,r=1e3){let i;for(let m=1;m<=t;m++)try{return await e()}catch(b){if(i=b,!this.isRetryable(b)||m===t)throw b;let a=r*Math.pow(2,m-1);await this.delay(a)}throw i}static isRetryable(e){return!!(e.name==="NetworkError"||e.message.includes("fetch")||e.status>=500||e.status===429)}static delay(e){return new Promise(t=>setTimeout(t,e))}};var j=class{constructor(){this.state={comments:[],loading:!1,error:null,theme:"default",replyingTo:null,user:null,pagination:{page:1,limit:50,total:0}},this.listeners=new Map,this.history=[],this.maxHistorySize=10}getState(){return{...this.state}}setState(e){let t={...this.state};this.state={...this.state,...e},this.history.push(t),this.history.length>this.maxHistorySize&&this.history.shift(),this.notifyListeners(e)}subscribe(e,t){return this.listeners.has(e)||this.listeners.set(e,[]),this.listeners.get(e).push(t),()=>{let r=this.listeners.get(e);if(r){let i=r.indexOf(t);i>-1&&r.splice(i,1)}}}notifyListeners(e){for(let[t,r]of this.listeners)t in e&&r.forEach(i=>i(this.state[t],e[t]))}undo(){if(this.history.length>0){let e=this.history.pop(),t={};for(let r in e)JSON.stringify(e[r])!==JSON.stringify(this.state[r])&&(t[r]=e[r]);return this.state=e,this.notifyListeners(t),!0}return!1}reset(){let e={comments:[],loading:!1,error:null,theme:"default",replyingTo:null,user:null,pagination:{page:1,limit:50,total:0}},t={};for(let r in this.state)JSON.stringify(e[r])!==JSON.stringify(this.state[r])&&(t[r]=e[r]);this.state=e,this.history=[],this.notifyListeners(t)}get(e){return this.state[e]}set(e,t){this.setState({[e]:t})}batch(e){this.setState(e)}get isLoading(){return this.state.loading}get hasError(){return this.state.error!==null}get commentCount(){return this.state.comments.length}get approvedComments(){return this.state.comments.filter(e=>e.is_approved===1)}get pendingComments(){return this.state.comments.filter(e=>e.is_approved===0)}get rejectedComments(){return this.state.comments.filter(e=>e.is_approved===2)}setLoading(e){this.setState({loading:e})}setError(e){this.setState({error:e})}clearError(){this.setState({error:null})}setComments(e){this.setState({comments:e})}addComment(e){let t=[...this.state.comments,e];this.setState({comments:t})}updateComment(e,t){let r=this.state.comments.map(i=>i.id===e?{...i,...t}:i);this.setState({comments:r})}removeComment(e){let t=this.state.comments.filter(r=>r.id!==e);this.setState({comments:t})}setTheme(e){this.setState({theme:e})}setReplyingTo(e){this.setState({replyingTo:e})}clearReplyingTo(){this.setState({replyingTo:null})}setUser(e){this.setState({user:e})}updatePagination(e){this.setState({pagination:{...this.state.pagination,...e}})}saveToStorage(){try{let e={theme:this.state.theme,user:this.state.user};localStorage.setItem("commentWidgetState",JSON.stringify(e))}catch(e){console.warn("Failed to save state to localStorage:",e)}}loadFromStorage(){try{let e=localStorage.getItem("commentWidgetState");if(e){let t=JSON.parse(e);this.setState(t)}}catch(e){console.warn("Failed to load state from localStorage:",e)}}use(e){let t=this.setState.bind(this);this.setState=r=>{e(r,this.state,t)}}};var ne=`/**
 * Enhanced Widget Styles with CSS Variables
 * Integrates with the dashboard theme system
 */

/* CSS Variables for theme integration */
:root {
    /* Widget-specific variables that sync with dashboard themes */
    --widget-primary: #007cba;
    --widget-secondary: #6c757d;
    --widget-success: #28a745;
    --widget-danger: #dc3545;
    --widget-warning: #ffc107;
    --widget-info: #17a2b8;
    --widget-light: #f8f9fa;
    --widget-dark: #343a40;
    --widget-background: #ffffff;
    --widget-surface: #f8f9fa;
    --widget-text: #333333;
    --widget-text-muted: #6c757d;
    --widget-border: #e0e0e0;
    --widget-shadow: rgba(0,0,0,0.1);

    /* Typography */
    --widget-font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    --widget-font-size: 16px;
    --widget-font-weight: 400;

    /* Spacing */
    --widget-spacing-xs: 0.25rem;
    --widget-spacing-sm: 0.5rem;
    --widget-spacing-md: 1rem;
    --widget-spacing-lg: 1.5rem;
    --widget-spacing-xl: 2rem;

    /* Design tokens */
    --widget-border-radius: 8px;
    --widget-transition: all 0.3s ease;
    --widget-transition-duration: 0.3s;
    --widget-transition-easing: ease-in-out;
}

/* Base widget container */
.comment-widget {
    font-family: var(--widget-font-family);
    max-width: 680px;
    margin: 2rem auto;
    padding: 1.5rem;
    background: var(--widget-background);
    border: 1px solid var(--widget-border);
    border-radius: var(--widget-border-radius);
    box-shadow: 0 2px 10px var(--widget-shadow);
    color: var(--widget-text);
    transition: var(--widget-transition);
    position: relative;
    overflow: hidden;
}

/* Header section */
.comment-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--widget-border);
}

.comment-header h3 {
    margin: 0;
    color: var(--widget-text);
    font-size: 1.5rem;
    font-weight: 600;
}

.theme-selector {
    padding: 0.5rem;
    border: 1px solid var(--widget-border);
    border-radius: var(--widget-border-radius);
    background: var(--widget-surface);
    color: var(--widget-text);
    font-size: 0.9rem;
    transition: var(--widget-transition);
}

.theme-selector:focus {
    border-color: var(--widget-primary);
    box-shadow: 0 0 0 0.2rem rgba(0, 124, 186, 0.25);
}

/* Form section */
.comment-form {
    background: var(--widget-surface);
    padding: 1.5rem;
    border-radius: var(--widget-border-radius);
    margin-bottom: 2rem;
    border: 1px solid var(--widget-border);
}

.form-group {
    margin-bottom: 1rem;
}

.form-group input,
.form-group textarea {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid var(--widget-border);
    border-radius: var(--widget-border-radius);
    font-size: 1rem;
    box-sizing: border-box;
    font-family: inherit;
    background: var(--widget-surface);
    color: var(--widget-text);
    transition: var(--widget-transition);
}

.form-group input:focus,
.form-group textarea:focus {
    border-color: var(--widget-primary);
    box-shadow: 0 0 0 0.2rem rgba(0, 124, 186, 0.25);
    outline: none;
}

.form-group textarea {
    min-height: 100px;
    resize: vertical;
}

.form-actions {
    text-align: right;
}

.submit-btn {
    background: var(--widget-primary);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: var(--widget-border-radius);
    font-size: 1rem;
    cursor: pointer;
    transition: var(--widget-transition);
    font-weight: 500;
}

.submit-btn:hover {
    background: var(--widget-primary);
    opacity: 0.9;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px var(--widget-shadow);
}

.submit-btn:active {
    transform: translateY(0);
}

.submit-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
    transform: none;
}

/* Comments list */
.comment-list {
    margin-top: 1.5rem;
}

.comment-item {
    display: flex;
    padding: 1rem;
    margin-bottom: 1rem;
    background: var(--widget-surface);
    border: 1px solid var(--widget-border);
    border-radius: var(--widget-border-radius);
    border-left: 3px solid var(--widget-primary);
    transition: var(--widget-transition);
    position: relative;
}

.comment-item:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px var(--widget-shadow);
    border-left-color: var(--widget-primary);
}

.comment-item.level-0 {
    border-left-color: var(--widget-primary);
}

.comment-item.level-1 {
    margin-left: 2rem;
    border-left-width: 2px;
    border-left-color: var(--widget-secondary);
}

.comment-item.level-2 {
    margin-left: 3rem;
    border-left-width: 1px;
    border-left-color: var(--widget-border);
}

/* Avatar */
.comment-avatar {
    margin-right: 1rem;
    flex-shrink: 0;
}

.avatar-placeholder {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--widget-primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.1rem;
    transition: var(--widget-transition);
}

.comment-item:hover .avatar-placeholder {
    transform: scale(1.1);
}

/* Comment content */
.comment-content {
    flex: 1;
}

.comment-meta {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}

.comment-author {
    font-weight: 600;
    color: var(--widget-primary);
}

.comment-date {
    color: var(--widget-text-muted);
}

.comment-text {
    line-height: 1.6;
    color: var(--widget-text);
    margin-bottom: 0.5rem;
}

.comment-actions {
    font-size: 0.8rem;
}

.reply-btn {
    background: none;
    border: none;
    color: var(--widget-primary);
    cursor: pointer;
    text-decoration: underline;
    font-size: 0.8rem;
    transition: var(--widget-transition);
}

.reply-btn:hover {
    color: var(--widget-primary);
    opacity: 0.8;
}

/* Nested replies */
.comment-replies {
    margin-top: 1rem;
    margin-left: 1rem;
    border-left: 2px solid var(--widget-border);
    padding-left: 1rem;
}

/* State indicators */
.loading-state,
.error-state,
.empty-state {
    text-align: center;
    padding: 2rem;
    font-style: italic;
}

.loading-state {
    color: var(--widget-text-muted);
}

.error-state {
    color: var(--widget-danger);
    background: rgba(220, 53, 69, 0.1);
    border: 1px solid var(--widget-danger);
    border-radius: var(--widget-border-radius);
}

.empty-state {
    color: var(--widget-text-muted);
}

.spinner {
    border: 3px solid var(--widget-light);
    border-top: 3px solid var(--widget-primary);
    border-radius: 50%;
    width: 30px;
    height: 30px;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Responsive design */
@media (max-width: 768px) {
    .comment-widget {
        margin: 1rem;
        padding: 1rem;
    }

    .comment-item.level-1,
    .comment-item.level-2 {
        margin-left: 1rem;
    }

    .theme-selector {
        margin-top: 0.5rem;
        width: 100%;
    }

    .comment-header {
        flex-direction: column;
        align-items: stretch;
    }

    .comment-meta {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.25rem;
    }
}

/* Animation classes */
.fade-in {
    animation: fadeIn 0.3s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.slide-in {
    animation: slideIn 0.3s ease-out;
}

@keyframes slideIn {
    from { opacity: 0; transform: translateX(-20px); }
    to { opacity: 1; transform: translateX(0); }
}

/* Theme transition effects */
.theme-transitioning .comment-widget {
    transform: scale(0.98);
    opacity: 0.9;
}

.theme-transitioning .comment-item {
    transform: translateY(2px);
    opacity: 0.8;
}

.theme-transitioning .submit-btn {
    transform: scale(0.95);
}

/* Accessibility improvements */
.comment-widget:focus-within {
    outline: 2px solid var(--widget-primary);
    outline-offset: 2px;
}

.reply-btn:focus,
.submit-btn:focus,
.theme-selector:focus {
    outline: 2px solid var(--widget-primary);
    outline-offset: 2px;
}

/* Screen reader only content */
.sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
}

/* Focus management */
.comment-item:focus-within {
    outline: 2px solid var(--widget-primary);
    outline-offset: 2px;
}

/* High contrast mode support */
@media (prefers-contrast: high) {
    .comment-widget {
        border: 2px solid;
    }

    .comment-item {
        border: 1px solid;
    }

    .reply-btn {
        border: 2px solid;
    }
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    .comment-widget,
    .comment-item,
    .submit-btn,
    .reply-btn {
        transition: none;
    }

    .fade-in,
    .slide-in {
        animation: none;
    }
}

/* Print styles */
@media print {
    .comment-widget {
        box-shadow: none;
        border: 1px solid #ccc;
    }

    .theme-selector,
    .reply-btn {
        display: none;
    }
}`;var G=class extends HTMLElement{constructor(){super(),this.threadId=this.getAttribute("thread-id")||Y.generateThreadId(),this.apiBaseUrl=this.getAttribute("api-base-url")||"https://comment-widget-backend.vercel.app",this.theme=this.getAttribute("theme")||"default",this.maxDepth=parseInt(this.getAttribute("max-depth"))||3,this.showThemeSelector=this.hasAttribute("show-theme-selector")||!0,this.api=new O(this.apiBaseUrl),this.renderer=new H,this.themeManager=new W(this.theme),this.stateManager=new j,this.stateManager.setTheme(this.theme),this.stateManager.loadFromStorage(),this.stateManager.subscribe("comments",e=>this.render()),this.stateManager.subscribe("loading",e=>this.render()),this.stateManager.subscribe("error",e=>this.render()),this.stateManager.subscribe("theme",e=>{this.theme=e,this.themeManager.setTheme(e),this.render()}),this.shadow=this.attachShadow({mode:"open"}),this.init()}async init(){try{this.stateManager.setLoading(!0),await this.loadComments(),this.stateManager.setLoading(!1)}catch(e){console.error("Widget initialization error:",e),R.handle(e,{context:"widget_init"}),this.stateManager.setError(e.message),this.stateManager.setLoading(!1)}}async loadComments(){try{let e=await R.withRetry(()=>this.api.getComments(this.threadId));this.stateManager.setComments(e.comments||[])}catch(e){console.error("Error loading comments:",e),R.handle(e,{context:"load_comments",threadId:this.threadId}),this.stateManager.setError("Failed to load comments")}}async submitComment(e){try{this.stateManager.setLoading(!0);let t=await R.withRetry(()=>this.api.createComment({thread_id:parseInt(this.threadId),author_name:e.author_name,author_email:e.author_email,content:e.content,parent_id:e.parent_id||null}));await this.loadComments(),this.stateManager.setLoading(!1);let r=e.parent_id?"Your reply has been posted successfully":"Your comment has been posted successfully";return this.announceToScreenReader(r),t}catch(t){throw console.error("Error submitting comment:",t),R.handle(t,{context:"submit_comment",commentData:e}),this.stateManager.setError(t.message),this.stateManager.setLoading(!1),this.announceToScreenReader("Error posting comment: "+t.message),t}}setTheme(e){this.stateManager.setTheme(e),this.stateManager.saveToStorage()}connectedCallback(){document.addEventListener("themeChange",e=>{e.detail&&e.detail.theme&&(this.setAttribute("theme",e.detail.theme),this.setTheme(e.detail.theme))})}render(){let e=this.stateManager.getState(),t=this.themeManager.getStyles(),r=this.renderer.render({comments:e.comments,loading:e.loading,error:e.error,theme:e.theme,maxDepth:this.maxDepth,showThemeSelector:this.showThemeSelector,replyingTo:e.replyingTo,onSubmit:i=>this.submitComment(i),onReply:i=>this.startReply(i),onCancelReply:()=>this.cancelReply(),onThemeChange:i=>this.setTheme(i)});this.shadow.innerHTML=`
            <style>${ne}${t}</style>
            ${r}
        `,this.attachEventListeners()}refresh(){this.loadComments()}getComments(){return this.stateManager.get("comments")}getTheme(){return this.stateManager.get("theme")}getState(){return this.stateManager.getState()}reset(){this.stateManager.reset()}undo(){return this.stateManager.undo()}startReply(e){this.stateManager.setReplyingTo(e),setTimeout(()=>{let t=this.shadow.getElementById("author-name");t&&(t.focus(),this.announceToScreenReader("Reply form opened. Enter your name to continue."))},100)}cancelReply(){this.stateManager.clearReplyingTo(),this.announceToScreenReader("Reply cancelled.")}attachEventListeners(){this.shadow.querySelectorAll(".reply-btn").forEach(m=>{m.addEventListener("click",b=>{let a=parseInt(b.target.getAttribute("data-parent-id"));this.startReply(a)})});let t=this.shadow.getElementById("cancel-reply-btn");t&&t.addEventListener("click",()=>{this.cancelReply()});let r=this.shadow.getElementById("theme-selector");r&&r.addEventListener("change",m=>{this.setTheme(m.target.value),this.announceThemeChange(m.target.value)});let i=this.shadow.getElementById("comment-form");i&&i.addEventListener("submit",async m=>{m.preventDefault();let b=new FormData(i),a={author_name:b.get("author-name"),author_email:b.get("author-email"),content:b.get("comment-content"),parent_id:this.replyingTo};await this.submitComment(a),i.reset(),this.cancelReply()}),this.setupKeyboardNavigation()}setupKeyboardNavigation(){let e=this.shadow.querySelector(".comment-widget");e.addEventListener("keydown",t=>{let r=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),i=Array.from(r),m=i.indexOf(document.activeElement);switch(t.key){case"ArrowDown":if(t.ctrlKey){t.preventDefault();let b=(m+1)%i.length;i[b].focus()}break;case"ArrowUp":if(t.ctrlKey){t.preventDefault();let b=m-1<0?i.length-1:m-1;i[b].focus()}break;case"Home":t.ctrlKey&&(t.preventDefault(),i[0].focus());break;case"End":t.ctrlKey&&(t.preventDefault(),i[i.length-1].focus());break}})}announceThemeChange(e){let t=`Theme changed to ${e}`;this.announceToScreenReader(t)}announceToScreenReader(e){let t=document.createElement("div");t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"),t.className="sr-only",t.textContent=e,this.shadow.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},1e3)}};customElements.define("comment-widget",G);document.addEventListener("DOMContentLoaded",()=>{console.log("Comment Widget v2.0 loaded")});typeof module<"u"&&module.exports&&(module.exports={CommentWidget:G});})();
